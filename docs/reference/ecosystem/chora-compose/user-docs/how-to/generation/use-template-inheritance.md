# How to Use Template Inheritance for Multi-Format Output

> **Goal:** Create reusable template hierarchies that generate multiple output formats from the same content.

## When to Use This

You need template inheritance when:
- Generating same content in multiple formats (Markdown, HTML, LaTeX)
- Sharing common structure across templates (headers, footers, navigation)
- Maintaining consistent styling across documents
- Creating themed output variants (light/dark, print/web)
- Building template libraries for reuse

## Prerequisites

- Chora Compose installed with Jinja2Generator
- Understanding of Jinja2 template basics
- Familiarity with content configurations
- Completed [Tutorial: Dynamic Content with Jinja2](../../tutorials/intermediate/01-dynamic-content-with-jinja2.md)

---

## Solution

### Quick Version

**Base template** (`templates/base.md.j2`):

```jinja2
{% block header %}
# {{ title }}
{% endblock %}

{% block metadata %}
**Author:** {{ author }}
**Date:** {{ date }}
{% endblock %}

{% block content %}
This is default content.
{% endblock %}

{% block footer %}
---
Generated by Chora Compose
{% endblock %}
```

**Child template** (`templates/article.md.j2`):

```jinja2
{% extends "base.md.j2" %}

{% block content %}
## Introduction

{{ intro }}

## Body

{{ body }}

## Conclusion

{{ conclusion }}
{% endblock %}
```

**Use it:**

```python
from chora_compose.generators.jinja2 import Jinja2Generator

generator = Jinja2Generator(template_dir="templates")

config = loader.load_content_config("article-content")
output = generator.generate(config)
# Uses article.md.j2 which inherits from base.md.j2
```

---

## Detailed Steps

### Step 1: Design Your Template Hierarchy

Plan your inheritance structure:

```
templates/
├── base.md.j2              # Root template (Markdown)
├── base.html.j2            # Root template (HTML)
├── document.md.j2          # Document type (extends base.md.j2)
├── article.md.j2           # Article type (extends document.md.j2)
├── report.md.j2            # Report type (extends document.md.j2)
└── api-reference.md.j2     # API docs (extends document.md.j2)
```

**Inheritance tree:**
```
base.md.j2
├── document.md.j2
│   ├── article.md.j2
│   ├── report.md.j2
│   └── api-reference.md.j2
└── (other document types)
```

### Step 2: Create Base Template

**Base Markdown template** (`templates/base.md.j2`):

```jinja2
{# Base template for all Markdown documents #}

{% block document_start %}
---
title: {{ title }}
author: {{ author | default('Unknown') }}
date: {{ date | default('N/A') }}
{% if tags %}
tags: {{ tags | join(', ') }}
{% endif %}
---
{% endblock %}

{% block header %}
# {{ title }}

{% if subtitle %}
**{{ subtitle }}**
{% endif %}
{% endblock %}

{% block metadata %}
**Author:** {{ author | default('Unknown') }}
**Version:** {{ version | default('1.0') }}
**Last Updated:** {{ date | default('N/A') }}
{% endblock %}

{% block toc %}
{# Table of contents - override in child templates #}
{% endblock %}

{% block content %}
{# Main content - MUST be overridden by child templates #}
This is default content. Override the 'content' block in your template.
{% endblock %}

{% block footer %}
---

{% block footer_metadata %}
*Generated with Chora Compose on {{ now().strftime('%Y-%m-%d') }}*
{% endblock %}

{% block footer_links %}
{% if source_url %}
[Source]({{ source_url }})
{% endif %}
{% endblock %}
{% endblock %}

{% block document_end %}
{# Any final content #}
{% endblock %}
```

### Step 3: Create Child Templates

**Document template** (`templates/document.md.j2`):

```jinja2
{% extends "base.md.j2" %}

{# Override to add document-specific TOC #}
{% block toc %}
## Table of Contents

{% for section in sections %}
- [{{ section.title }}](#{{ section.title | lower | replace(' ', '-') }})
{% endfor %}
{% endblock %}

{# Document structure #}
{% block content %}
{% for section in sections %}
## {{ section.title }}

{{ section.content }}

{% endfor %}
{% endblock %}
```

**Article template** (`templates/article.md.j2`):

```jinja2
{% extends "document.md.j2" %}

{# Articles have introduction, body, conclusion #}
{% block content %}
## Introduction

{{ introduction }}

## {{ main_heading | default('Content') }}

{{ body }}

## Conclusion

{{ conclusion }}

{% if references %}
## References

{% for ref in references %}
{{ loop.index }}. {{ ref }}
{% endfor %}
{% endif %}
{% endblock %}

{# Override footer to add article-specific info #}
{% block footer_metadata %}
*Article published on {{ publish_date | default(date) }}*
*Reading time: {{ reading_time | default('5') }} minutes*

{{ super() }}  {# Include parent's footer_metadata too #}
{% endblock %}
```

**Report template** (`templates/report.md.j2`):

```jinja2
{% extends "document.md.j2" %}

{# Reports have executive summary #}
{% block content %}
## Executive Summary

{{ executive_summary }}

{{ super() }}  {# Include parent's content (all sections) #}

## Recommendations

{% for recommendation in recommendations %}
{{ loop.index }}. {{ recommendation }}
{% endfor %}

## Appendix

{{ appendix | default('No appendix provided.') }}
{% endblock %}
```

### Step 4: Create Content Configuration

**Content config** (`configs/content/articles/my-article-content.json`):

```json
{
  "type": "content",
  "id": "my-article",
  "schemaRef": {
    "uri": "file://schemas/content/v3.1/schema.json",
    "version": "3.1"
  },
  "metadata": {
    "name": "My Article",
    "description": "Sample article using template inheritance",
    "version": "1.0"
  },
  "generation": {
    "patterns": [
      {
        "id": "article-pattern",
        "type": "jinja2",
        "template": "article.md.j2",
        "context": {
          "title": "Understanding Template Inheritance",
          "subtitle": "A Deep Dive into Jinja2 Templates",
          "author": "Technical Writer",
          "date": "2025-10-11",
          "tags": ["jinja2", "templates", "documentation"],
          "introduction": "Template inheritance is a powerful feature...",
          "body": "Jinja2 allows templates to extend base templates...",
          "conclusion": "By using inheritance, you can create maintainable...",
          "references": [
            "Jinja2 Documentation: https://jinja.palletsprojects.com",
            "Chora Compose Documentation: https://github.com/liminalcommons/chora-compose/tree/main/docs"
          ],
          "reading_time": "8",
          "publish_date": "2025-10-11"
        }
      }
    ]
  }
}
```

### Step 5: Generate Output

```python
from pathlib import Path
from chora_compose.core.config_loader import ConfigLoader
from chora_compose.generators.jinja2 import Jinja2Generator

# Initialize
loader = ConfigLoader()
generator = Jinja2Generator(template_dir=Path("templates"))

# Load config
config = loader.load_content_config("my-article")

# Generate
output = generator.generate(config)

# Save
output_path = Path("output/article.md")
output_path.parent.mkdir(parents=True, exist_ok=True)
output_path.write_text(output, encoding="utf-8")

print(f"✓ Generated: {output_path}")
```

**Generated output:**

```markdown
---
title: Understanding Template Inheritance
author: Technical Writer
date: 2025-10-11
tags: jinja2, templates, documentation
---

# Understanding Template Inheritance

**A Deep Dive into Jinja2 Templates**

**Author:** Technical Writer
**Version:** 1.0
**Last Updated:** 2025-10-11

## Table of Contents

- [Introduction](#introduction)
- [Content](#content)
- [Conclusion](#conclusion)

## Introduction

Template inheritance is a powerful feature...

## Content

Jinja2 allows templates to extend base templates...

## Conclusion

By using inheritance, you can create maintainable...

## References

1. Jinja2 Documentation: https://jinja.palletsprojects.com
2. Chora Compose Documentation: https://github.com/liminalcommons/chora-compose/tree/main/docs

---

*Article published on 2025-10-11*
*Reading time: 8 minutes*

*Generated with Chora Compose on 2025-10-11*

[Source](#)
```

---

## Common Patterns

### Pattern: Multi-Format Output (Markdown + HTML)

Generate both Markdown and HTML from same content:

**Base HTML template** (`templates/base.html.j2`):

```jinja2
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block page_title %}{{ title }}{% endblock %}</title>
    {% block styles %}
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        .metadata { color: #666; font-size: 0.9em; }
    </style>
    {% endblock %}
</head>
<body>
    {% block header %}
    <header>
        <h1>{{ title }}</h1>
        {% if subtitle %}
        <p class="subtitle">{{ subtitle }}</p>
        {% endif %}
    </header>
    {% endblock %}

    {% block metadata %}
    <div class="metadata">
        <p><strong>Author:</strong> {{ author | default('Unknown') }}</p>
        <p><strong>Date:</strong> {{ date | default('N/A') }}</p>
    </div>
    {% endblock %}

    <main>
        {% block content %}
        <p>Default content</p>
        {% endblock %}
    </main>

    {% block footer %}
    <footer>
        <hr>
        <p><em>Generated with Chora Compose on {{ now().strftime('%Y-%m-%d') }}</em></p>
    </footer>
    {% endblock %}
</body>
</html>
```

**Article HTML template** (`templates/article.html.j2`):

```jinja2
{% extends "base.html.j2" %}

{% block content %}
<article>
    <section id="introduction">
        <h2>Introduction</h2>
        {{ introduction | safe }}
    </section>

    <section id="body">
        <h2>{{ main_heading | default('Content') }}</h2>
        {{ body | safe }}
    </section>

    <section id="conclusion">
        <h2>Conclusion</h2>
        {{ conclusion | safe }}
    </section>

    {% if references %}
    <section id="references">
        <h2>References</h2>
        <ol>
        {% for ref in references %}
            <li>{{ ref }}</li>
        {% endfor %}
        </ol>
    </section>
    {% endif %}
</article>
{% endblock %}
```

**Generate both formats:**

```python
from pathlib import Path

# Same content config, different templates
config = loader.load_content_config("my-article")

# Generate Markdown
config.generation.patterns[0].template = "article.md.j2"
markdown = generator.generate(config)
Path("output/article.md").write_text(markdown)

# Generate HTML
config.generation.patterns[0].template = "article.html.j2"
html = generator.generate(config)
Path("output/article.html").write_text(html)

print("✓ Generated both Markdown and HTML versions")
```

**Use case:** Publishing to web (HTML) and GitHub (Markdown)

### Pattern: Themed Variants

Create light and dark theme variants:

**Base with theme support** (`templates/themed-base.html.j2`):

```jinja2
<!DOCTYPE html>
<html lang="en" data-theme="{{ theme | default('light') }}">
<head>
    <title>{{ title }}</title>
    {% block styles %}
    <style>
        /* Light theme (default) */
        [data-theme="light"] {
            --bg-color: #ffffff;
            --text-color: #000000;
            --heading-color: #333333;
            --link-color: #0066cc;
        }

        /* Dark theme */
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --link-color: #66b3ff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        h1, h2, h3 { color: var(--heading-color); }
        a { color: var(--link-color); }
    </style>
    {% endblock %}
</head>
<body>
    {% block content %}{% endblock %}
</body>
</html>
```

**Generate both themes:**

```python
themes = ["light", "dark"]

for theme in themes:
    # Add theme to context
    config.generation.patterns[0].context["theme"] = theme

    output = generator.generate(config)

    # Save theme-specific output
    output_path = Path(f"output/article-{theme}.html")
    output_path.write_text(output)

    print(f"✓ Generated {theme} theme: {output_path}")
```

**Use case:** Providing user preference options

### Pattern: Conditional Sections

Include/exclude sections based on context:

**Template with conditional blocks:**

```jinja2
{% extends "base.md.j2" %}

{% block content %}
## Overview

{{ overview }}

{% if include_installation %}
{% block installation %}
## Installation

{{ installation_instructions }}
{% endblock %}
{% endif %}

{% if include_api_reference %}
{% block api_reference %}
## API Reference

{{ api_docs }}
{% endblock %}
{% endif %}

{% if include_examples %}
{% block examples %}
## Examples

{% for example in examples %}
### {{ example.title }}

{{ example.code }}
{% endfor %}
{% endblock %}
{% endif %}

{% if include_troubleshooting %}
{% block troubleshooting %}
## Troubleshooting

{{ troubleshooting_content }}
{% endblock %}
{% endif %}
{% endblock %}
```

**Context controls sections:**

```python
# Full documentation
full_context = {
    "title": "Complete Guide",
    "overview": "...",
    "include_installation": True,
    "include_api_reference": True,
    "include_examples": True,
    "include_troubleshooting": True,
    # ... actual content ...
}

# Quick start guide (minimal)
quickstart_context = {
    "title": "Quick Start",
    "overview": "...",
    "include_installation": True,
    "include_api_reference": False,
    "include_examples": True,
    "include_troubleshooting": False,
    # ... actual content ...
}

# Generate both
for name, ctx in [("full", full_context), ("quickstart", quickstart_context)]:
    config.generation.patterns[0].context = ctx
    output = generator.generate(config)
    Path(f"output/{name}.md").write_text(output)
```

**Use case:** Different documentation levels for different audiences

### Pattern: Macro Libraries

Create reusable macros in base templates:

**Base with macros** (`templates/macros.md.j2`):

```jinja2
{# Macro for code blocks with syntax highlighting hint #}
{% macro code_block(language, code) %}
```{{ language }}
{{ code }}
```
{% endmacro %}

{# Macro for admonitions/callouts #}
{% macro admonition(type, title, content) %}
> **{{ type | upper }}: {{ title }}**
>
> {{ content }}
{% endmacro %}

{# Macro for tables #}
{% macro table(headers, rows) %}
| {{ headers | join(' | ') }} |
| {{ ('---' + ' | ') * (headers | length) }}
{% for row in rows %}
| {{ row | join(' | ') }} |
{% endfor %}
{% endmacro %}

{# Macro for cross-references #}
{% macro xref(text, link) %}
[{{ text }}]({{ link }})
{% endmacro %}
```

**Use macros in document** (`templates/tutorial.md.j2`):

```jinja2
{% from "macros.md.j2" import code_block, admonition, table %}

{% extends "base.md.j2" %}

{% block content %}
## Introduction

{{ introduction }}

{{ admonition('Note', 'Prerequisites', 'Ensure you have Python 3.12+ installed.') }}

## Installation

{{ code_block('bash', 'pip install chora-compose') }}

## Configuration

{{ code_block('json', config_example) }}

{{ admonition('Warning', 'Important', 'Always validate your configs before deployment.') }}

## API Reference

{{ table(['Method', 'Description', 'Returns'], api_methods) }}

{% endblock %}
```

**Use case:** Consistent formatting across all documentation

### Pattern: Multi-Level Inheritance

Deep inheritance hierarchies:

```
base.md.j2
└── document.md.j2
    └── technical-doc.md.j2
        ├── api-reference.md.j2
        ├── architecture-doc.md.j2
        └── tutorial.md.j2
```

**Technical document template** (`templates/technical-doc.md.j2`):

```jinja2
{% extends "document.md.j2" %}

{# All technical docs have prerequisites and glossary #}

{% block content %}
{% block prerequisites %}
## Prerequisites

{% for prereq in prerequisites %}
- {{ prereq }}
{% endfor %}
{% endblock %}

{{ super() }}  {# Include parent document content #}

{% block glossary %}
## Glossary

{% for term, definition in glossary.items() %}
**{{ term }}**: {{ definition }}

{% endfor %}
{% endblock %}
{% endblock %}
```

**API reference extends technical doc** (`templates/api-reference.md.j2`):

```jinja2
{% extends "technical-doc.md.j2" %}

{# Override content for API-specific structure #}
{% block content %}
{{ super() }}  {# Includes prerequisites from technical-doc #}

## API Overview

{{ api_overview }}

{% for endpoint in endpoints %}
### {{ endpoint.method }} {{ endpoint.path }}

{{ endpoint.description }}

**Parameters:**
{% for param in endpoint.parameters %}
- `{{ param.name }}` ({{ param.type }}) - {{ param.description }}
{% endfor %}

**Response:**
```json
{{ endpoint.response_example | tojson(indent=2) }}
```

{% endfor %}

{{ super() }}  {# Includes glossary from technical-doc #}
{% endblock %}
```

**Use case:** Deeply structured documentation with shared components

---

## Advanced Usage

### Block Composition with `super()`

Combine parent and child block content:

```jinja2
{# base.md.j2 #}
{% block footer %}
*Generated with Chora Compose*
{% endblock %}

{# child.md.j2 #}
{% block footer %}
{{ super() }}  {# Include parent's footer #}

*Custom footer addition*
{% endblock %}

{# Result: #}
*Generated with Chora Compose*

*Custom footer addition*
```

### Named Block Scopes

Access outer block variables:

```jinja2
{% block outer %}
    {% set outer_var = "value" %}

    {% block inner %}
        {# Can access outer_var here #}
        {{ outer_var }}
    {% endblock %}
{% endblock %}
```

### Dynamic Template Selection

Choose template at runtime:

```python
def generate_with_template(content_id: str, template_name: str) -> str:
    """Generate content with specified template."""
    config = loader.load_content_config(content_id)

    # Override template
    config.generation.patterns[0].template = template_name

    return generator.generate(config)

# Use it
markdown_output = generate_with_template("my-doc", "article.md.j2")
html_output = generate_with_template("my-doc", "article.html.j2")
latex_output = generate_with_template("my-doc", "article.tex.j2")
```

### Template Includes (Alternative to Inheritance)

For partial reuse without inheritance:

**Partial template** (`templates/partials/code-example.md.j2`):

```jinja2
**Example:**

```{{ language }}
{{ code }}
```

{{ description }}
```

**Main template:**

```jinja2
## How to Use

{% include 'partials/code-example.md.j2' with context %}

## Advanced Usage

{% include 'partials/code-example.md.j2' %}
```

**When to use includes vs inheritance:**
- **Inheritance:** Whole document structure reuse
- **Includes:** Small snippet/component reuse

---

## Troubleshooting

**Problem:** `TemplateNotFound: base.md.j2`
**Solution:**
- Verify template exists in `template_dir`
- Check template path in `{% extends %}` is correct
- Ensure `Jinja2Generator(template_dir=Path("templates"))`
- Use relative paths from template_dir

**Problem:** `Block 'content' not found`
**Solution:**
- Ensure base template defines the block
- Check block names match exactly (case-sensitive)
- Don't have typos in `{% block %}` / `{% endblock %}`

**Problem:** `super()` returns nothing
**Solution:**
- Verify parent template has content in that block
- Ensure you're calling `super()` inside the same block name
- Check inheritance chain is correct

**Problem:** Context variables not available in child template
**Solution:**
- Context is shared across all templates in inheritance chain
- No need to pass context explicitly
- If variable missing, check it's in original context dict

**Problem:** Circular inheritance
**Solution:**
```jinja2
{# BAD - circular #}
{# a.j2 extends b.j2 #}
{# b.j2 extends a.j2 #}

{# GOOD - tree structure #}
{# a.j2 extends base.j2 #}
{# b.j2 extends base.j2 #}
```

**Problem:** Block appears multiple times in output
**Solution:**
- Don't call `{{ super() }}` multiple times in same block
- Blocks should be defined once per template
- Check for accidental duplicate block definitions

**Problem:** Macros not found in child template
**Solution:**
```jinja2
{# Import macros explicitly #}
{% from "macros.md.j2" import code_block %}

{# Then can use #}
{{ code_block('python', code) }}
```

---

## Best Practices

### 1. Design Template Hierarchy Early

Plan your inheritance structure before creating templates:

```
base.md.j2 (common structure)
├── document.md.j2 (section-based docs)
│   ├── article.md.j2
│   ├── report.md.j2
│   └── tutorial.md.j2
├── api-doc.md.j2 (API-specific docs)
└── reference.md.j2 (reference material)
```

### 2. Keep Base Templates Minimal

**Good:**
```jinja2
{# base.md.j2 - minimal structure #}
{% block header %}{% endblock %}
{% block content %}{% endblock %}
{% block footer %}{% endblock %}
```

**Bad:**
```jinja2
{# base.md.j2 - too opinionated #}
{% block header %}
# {{ title }}
## {{ subtitle }}
### {{ subsubtitle }}
...way too much structure...
{% endblock %}
```

### 3. Use Descriptive Block Names

**Good:**
```jinja2
{% block prerequisites %}
{% block installation_instructions %}
{% block api_reference %}
{% block troubleshooting %}
```

**Bad:**
```jinja2
{% block section1 %}
{% block part2 %}
{% block stuff %}
```

### 4. Document Your Template Hierarchy

Add comments to templates:

```jinja2
{#
Template: article.md.j2
Extends: document.md.j2
Used for: Blog posts, articles, essays

Blocks defined:
- content: Main article content (intro, body, conclusion)
- footer_metadata: Article-specific footer info

Usage:
    config.generation.patterns[0].template = "article.md.j2"
#}

{% extends "document.md.j2" %}
...
```

### 5. Test Each Level of Inheritance

```python
# Test each template independently
templates = ["base.md.j2", "document.md.j2", "article.md.j2"]

for template in templates:
    print(f"\nTesting {template}...")

    config.generation.patterns[0].template = template
    output = generator.generate(config)

    # Verify expected blocks rendered
    assert "# " + config.generation.patterns[0].context["title"] in output
    print(f"✓ {template} renders correctly")
```

---

## See Also

- [How to: Generate API Docs from OpenAPI](generate-api-docs-from-openapi.md) - Apply inheritance to API docs
- [How to: Debug Jinja2 Template Errors](debug-jinja2-templates.md) - Fix template issues
- [Tutorial: Dynamic Content with Jinja2](../../tutorials/intermediate/01-dynamic-content-with-jinja2.md) - Learn basics
- [Jinja2Generator API Reference](../../reference/api/generators/jinja2.md) - Technical details
- [Why Jinja2 for Dynamic Generation](../../explanation/architecture/why-jinja2-for-dynamic-generation.md) - Design rationale
