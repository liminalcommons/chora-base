# Upgrading from v1.0.0 to v1.1.0

**Release Date**: 2025-10-18
**Template Version**: v1.0.0 → v1.1.0
**Upgrade Effort**: 30 minutes
**For**: Human developers, AI coding agents

---

## Quick Assessment

| Aspect | Value |
|--------|-------|
| **Effort** | 30 minutes |
| **Breaking Changes** | No |
| **Required For** | Enhanced documentation, A-MEM workflows |
| **Can Skip If** | Not using memory system, don't need new docs |
| **Displacement Risk** | LOW (pure documentation, 100% additive) |
| **Agent Autonomy** | 90% (very straightforward decision) |

---

## TL;DR

**What's New**:
- AGENTS.md enhancements (+645 lines): A-MEM integration, memory troubleshooting
- Diátaxis documentation suite (4 new docs: how-to, reference guides)
- README restructure (human vs agent audience separation)

**Impact on Existing Adopters**:
- IF using memory system: Major value-add (troubleshooting, A-MEM workflows)
- IF not using memory: New documentation helps with project generation decisions
- Zero code changes, zero conflicts expected

**Recommended Action**:
- **For projects with memory system**: Upgrade (get troubleshooting guides)
- **For projects without memory**: Optional (nice to have, not critical)
- **For all projects**: Safe upgrade (documentation only)

---

## Decision Tree for AI Agents

```
START

├─ Does project use memory system (include_memory_system=true)?
│  ├─ YES → Upgrade RECOMMENDED (A-MEM workflows + troubleshooting)
│  └─ NO → Continue evaluation
│
├─ Does project have AGENTS.md?
│  ├─ YES → Upgrade beneficial (enhanced agent instructions)
│  └─ NO → Skip (not relevant)
│
├─ Planning to generate new projects from template?
│  ├─ YES → Upgrade helpful (new documentation guides)
│  └─ NO → Skip (low priority)
│
END: RECOMMENDED for memory projects, OPTIONAL otherwise
```

**Criteria by Project Type**:

| Project Type | Adopt If | Defer If | Skip If |
|--------------|----------|----------|---------|
| **With Memory System** | Always (troubleshooting value) | N/A | N/A |
| **With AGENTS.md** | Enhanced instructions | Not actively using | No AGENTS.md |
| **Without Memory/AGENTS** | Planning future use | Stable, no changes | Never using |

---

## What Changed

### Files Added

**New Documentation Files** (in chora-base repo, not generated projects):
1. `docs/DOCUMENTATION_PLAN.md` (390 lines)
   - Complete documentation strategy
   - Diátaxis framework explanation
   - Coverage metrics for docs

2. `docs/how-to/01-generate-new-mcp-server.md` (100 lines)
   - Quick start guide for new projects
   - Step-by-step generation process

3. `docs/how-to/02-rip-and-replace-existing-server.md` (316 lines)
   - 8-phase migration workflow
   - Adopting chora-base in existing projects

4. `docs/reference/template-configuration.md` (215 lines)
   - Complete lookup table for 30+ copier variables
   - Decision support for template choices

5. `docs/reference/rip-and-replace-decision-matrix.md` (173 lines)
   - When to adopt vs stay custom
   - Migration strategy selector

### Files Modified

**Changed Template Files**:

1. `template/AGENTS.md.jinja`
   - **Lines changed**: +665 -20
   - **Change type**: Enhancement (A-MEM integration + troubleshooting)
   - **Displacement risk**: NONE (pure addition)
   - **Customization impact**: Unlikely to conflict (adds new sections)
   - **Diff summary**:
     ```diff
     + ## A-MEM Integration
     + [8-step learning loop with visual diagram]

     + ## Memory Troubleshooting
     + [260 lines of self-service debugging guides]

     + ## Agent Self-Service Workflows
     + [Complete bash examples for common tasks]

     + ## Diátaxis Framework
     + [Documentation philosophy for agents]
     ```

2. `README.md` (chora-base repo)
   - **Lines changed**: +58 -0
   - **Change type**: Enhancement (documentation section)
   - **Impact**: Only affects chora-base repo, not generated projects

3. `CHANGELOG.md` (chora-base repo)
   - **Lines changed**: +64 -0
   - **Change type**: Documentation (v1.1.0 release notes)
   - **Impact**: Only affects chora-base repo

**Note**: This release only modifies template files (AGENTS.md.jinja). When you generate NEW projects with v1.1.0, they'll include the enhanced AGENTS.md. Existing projects can adopt changes via copier update.

---

## Displacement Analysis

### Type 1: Required (Correctness Fixes)

**None** - This release contains no critical fixes.

### Type 2: Optional (Workflow Improvements)

**None** - This release does not advocate replacing existing workflows.

### Type 3: Additive (Safe Enhancements)

#### Enhancement: AGENTS.md A-MEM Integration

**What Added**:
- 8-step agent learning loop (visual diagram)
- A-MEM memory system integration workflows
- Knowledge capture patterns

**Benefits**:
- Agents can learn across sessions
- Structured approach to knowledge storage
- Complements existing memory system

**Costs**:
- None (pure addition, no displacement)

**Decision**: Adopt if using memory system

#### Enhancement: Memory Troubleshooting Section

**What Added** (260 lines):
- CLI error troubleshooting (commands not found, query syntax)
- Event log debugging (emission verification, trace correlation)
- Knowledge graph issues (broken links, tag corruption, search)
- Trace context debugging (CHORA_TRACE_ID propagation)

**Benefits**:
- Self-service debugging for AI agents
- Reduces "stuck" situations
- Common issues + solutions documented

**Costs**:
- None (pure addition)

**Decision**: Adopt if using memory system

#### Enhancement: Agent Self-Service Workflows

**What Added**:
- Learning from past errors workflow
- Creating knowledge from debugging sessions
- Real example: Rate limit fix (96% improvement)

**Benefits**:
- Concrete examples for agents
- Workflow templates for common tasks

**Costs**:
- None (pure addition)

**Decision**: Adopt (helpful for all agent workflows)

#### Enhancement: Diátaxis Framework Documentation

**What Added**:
- Documentation philosophy (task/tutorial/reference/explanation)
- Recommended reading order for AI agents
- Human learning path
- DDD/BDD/TDD workflow explanation

**Benefits**:
- Clearer navigation of documentation
- Agents know where to look for what
- Humans understand doc structure

**Costs**:
- None (pure addition)

**Decision**: Adopt (improves doc usability)

---

## Upgrade Steps

### Prerequisites

```bash
# 1. Ensure clean git state
git status
# Should show "nothing to commit, working tree clean"

# 2. Create backup
git branch backup-pre-upgrade-v1.1.0
git tag backup-v1.0.0

# 3. Review current template version
cat .copier-answers.yml | grep _commit
# Should show v1.0.0

# 4. Document customizations (if AGENTS.md customized)
# Note any custom sections you've added to AGENTS.md
```

### Automated Upgrade

```bash
# Update to v1.1.0
copier update --vcs-ref v1.1.0 --trust

# Review changes
git diff

# Expected changes:
# - .copier-answers.yml (_commit: v1.0.0 → v1.1.0)
# - AGENTS.md (new sections added)

# Test (no code changes, so this is quick)
./scripts/check-env.sh
pytest  # Should still pass (no code changes)
```

### Manual Conflict Resolution

**Conflicts are unlikely** in this upgrade (pure documentation addition), but if AGENTS.md was customized:

#### Conflict: AGENTS.md (Custom Sections)

**Template Change** (added sections):
```markdown
## A-MEM Integration
[new content]

## Memory Troubleshooting
[new content]

## Agent Self-Service Workflows
[new content]

## Diátaxis Framework
[new content]
```

**Your Customization** (likely):
```markdown
## Project-Specific Agent Workflows
[your custom content]
```

**Merge Strategy**:
1. Accept template's new sections
2. Keep your custom sections
3. Combined result:
   ```markdown
   <!-- Template sections -->
   ## A-MEM Integration
   [template content]

   ## Memory Troubleshooting
   [template content]

   <!-- Your custom sections -->
   ## Project-Specific Agent Workflows
   [your custom content]
   ```

**Validation**:
```bash
# Ensure AGENTS.md is valid markdown
# Check that both template and custom sections are present
cat AGENTS.md | grep "##"  # Should show all section headers
```

---

## Validation Checklist

### Core Functionality

- [ ] Project imports work: `python -c "from {{ package_name }} import *"`
- [ ] Tests pass: `pytest`
- [ ] Scripts execute: `./scripts/check-env.sh`
- [ ] No code changed (this is docs-only release)

### Template Integration

- [ ] AGENTS.md has new sections:
  - [ ] A-MEM Integration
  - [ ] Memory Troubleshooting
  - [ ] Agent Self-Service Workflows
  - [ ] Diátaxis Framework
- [ ] `.copier-answers.yml` shows `_commit: v1.1.0`
- [ ] Custom AGENTS.md sections preserved (if any)

### Quality Gates

- [ ] Pre-commit hooks pass: `pre-commit run --all-files`
- [ ] Linting passes: `ruff check .`
- [ ] Type checking passes: `mypy src/`
- [ ] Coverage maintained: `pytest --cov`

### Documentation

- [ ] AGENTS.md readable and well-formatted
- [ ] Custom sections still present (if any)
- [ ] No broken links in AGENTS.md

---

## Example Upgrade Session

```bash
# Starting state (v1.0.0 project)
$ cat .copier-answers.yml | grep _commit
_commit: v1.0.0

$ git status
On branch main
nothing to commit, working tree clean

# Create backup
$ git branch backup-pre-upgrade-v1.1.0
$ git tag backup-v1.0.0

# Run upgrade
$ copier update --vcs-ref v1.1.0 --trust

[copier applies updates - no prompts, just file changes]

# Review changes
$ git status
On branch main
Changes not staged for commit:
  modified:   .copier-answers.yml
  modified:   AGENTS.md

$ git diff .copier-answers.yml
-_commit: v1.0.0
+_commit: v1.1.0

$ git diff AGENTS.md | head -20
+## A-MEM Integration
+
+This project uses the A-MEM (Agent Memory) system...
+[new sections added]

$ wc -l AGENTS.md
1294 AGENTS.md  # Was ~900, now ~1294 (+394 lines net)

# Validate (no code changes, so quick)
$ ./scripts/check-env.sh
✓ Python 3.11.5
✓ Dependencies installed
✓ Pre-commit hooks installed
✓ Environment variables set

$ pytest
===== 42 passed in 3.14s =====

# Commit upgrade
$ git add .
$ git commit -m "chore: Upgrade to chora-base v1.1.0

- Updated from v1.0.0 to v1.1.0
- Enhanced AGENTS.md:
  - A-MEM Integration (8-step learning loop)
  - Memory Troubleshooting (260 lines)
  - Agent Self-Service Workflows
  - Diátaxis Framework documentation
- Documentation-only upgrade (no code changes)
- All tests passing

See docs/upgrades/v1.0-to-v1.1.md for details"

$ git log --oneline -1
e5f6g7h chore: Upgrade to chora-base v1.1.0
```

---

## Rollback Procedure

**If upgrade fails or causes issues** (unlikely for docs-only release):

```bash
# Option 1: Rollback commit
git reset --hard HEAD~1

# Option 2: Restore from backup branch
git checkout main
git reset --hard backup-pre-upgrade-v1.1.0

# Option 3: Restore from tag
git checkout main
git reset --hard backup-v1.0.0

# Verify rollback
cat .copier-answers.yml | grep _commit
# Should show v1.0.0

./scripts/check-env.sh
pytest
```

**Report issues** (unlikely, but if encountered):
- GitHub: https://github.com/liminalcommons/chora-base/issues/new
- Include: version numbers (v1.0.0 → v1.1.0), AGENTS.md customizations if any

---

## Common Issues

### Issue 1: AGENTS.md Formatting Breaks

**Symptom**:
Markdown renderer shows broken formatting in AGENTS.md

**Cause**: Merge conflict or manual edit introduced syntax error

**Solution**:
```bash
# Validate markdown syntax
# Use VS Code markdown preview or markdownlint

# If broken, restore template version and re-apply customizations
git checkout v1.1.0 -- AGENTS.md
# Then manually re-add your custom sections
```

### Issue 2: Custom AGENTS.md Sections Lost

**Symptom**:
Your custom sections in AGENTS.md are missing after upgrade

**Cause**: Copier overwrote instead of merging

**Solution**:
```bash
# Restore from backup
git diff backup-v1.0.0 AGENTS.md > custom_sections.patch

# Review patch to extract your custom sections
cat custom_sections.patch

# Manually re-add to upgraded AGENTS.md
# (Add at end of file, after template sections)
```

---

## For AI Agents: Decision Documentation

**After completing upgrade, store decision**:

```json
{
  "id": "chora-base-v1.0-to-v1.1-upgrade",
  "created": "2025-10-XX",
  "tags": ["chora-base", "upgrade", "v1.1.0", "documentation"],

  "upgrade": {
    "from": "v1.0.0",
    "to": "v1.1.0",
    "decision": "adopted",
    "reasoning": "Documentation enhancements valuable, zero code changes, zero risk"
  },

  "changes": [
    {
      "file": "AGENTS.md",
      "type": "enhancement",
      "additions": [
        "A-MEM Integration (8-step learning loop)",
        "Memory Troubleshooting (260 lines of self-service debugging)",
        "Agent Self-Service Workflows (examples)",
        "Diátaxis Framework (documentation navigation)"
      ]
    }
  ],

  "customizations_preserved": [
    "AGENTS.md: Custom project-specific workflows section intact"
  ],

  "benefits_realized": [
    "Memory troubleshooting guides available",
    "A-MEM workflow documented",
    "Diátaxis navigation improves doc discovery"
  ],

  "validation": {
    "tests": "passing (pytest: 42 passed)",
    "coverage": "maintained",
    "scripts": "working (./scripts/check-env.sh: all checks passed)",
    "agents_md": "enhanced with 4 new sections"
  },

  "time_invested": "15 minutes (upgrade + validation)",
  "displacement": "none (100% additive)"
}
```

---

## Related Documentation

- [Upgrade Philosophy](PHILOSOPHY.md) - Principles and decision frameworks
- [v1.1.0 CHANGELOG](../../CHANGELOG.md#110---2025-10-18) - Full release notes
- [Next upgrade: v1.1.0 to v1.1.1](v1.1-to-v1.1.1.md) - Metadata schema docs (patch)
- [Next upgrade: v1.1.0 to v1.2.0](v1.1-to-v1.2.md) - Generalization fixes (required)

---

**Note**: This is the simplest upgrade in the v1.0→v1.4 sequence. Pure documentation, zero code changes, zero displacement. Perfect starting point for understanding chora-base's upgrade process!
