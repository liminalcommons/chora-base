# Upgrading from v1.9.2 to v1.9.3

**Release Date**: 2025-10-22
**Template Version**: v1.9.2 → v1.9.3
**Upgrade Effort**: <10 minutes
**For**: Human developers, AI coding agents

---

## Quick Assessment

| Aspect | Value |
|--------|-------|
| **Effort** | <10 minutes |
| **Breaking Changes** | No |
| **Required For** | Enhanced agent capabilities (optional) |
| **Can Skip If** | Not using AI agents extensively for development |
| **Displacement Risk** | ZERO (documentation-only) |
| **Agent Autonomy** | 100% (fully autonomous upgrade) |

---

## TL;DR

**What's New**:
- Super-tests guidance for system-level validation (~50 lines documentation)
- Memory architecture overview (3-tier model) (~40 lines documentation)
- Advanced memory query patterns (~60 lines documentation with examples)

**Impact on Existing Adopters**:
- ZERO code changes required
- 100% documentation enhancements
- AGENTS.md.jinja only (no functional changes)

**Recommended Action**:
- **For new projects**: Adopt immediately (improved agent guidance)
- **For existing adopters**: Upgrade optional (benefits AI agents, no downside)
- **For heavily customized projects**: Safe to upgrade (AGENTS.md rarely customized)

**Note**: This is the **final release before v2.0.0** architectural refactoring of AGENTS.md structure.

---

## Decision Tree for AI Agents

```
START

├─ Does project use AGENTS.md?
│  ├─ NO → Skip upgrade (not relevant)
│  └─ YES → Continue evaluation
│
├─ Have you customized AGENTS.md?
│  ├─ NO → Safe to adopt (copier update, no conflicts)
│  └─ YES → Review changes below, merge manually if desired
│
├─ Do you want enhanced agent capabilities?
│  ├─ YES → Adopt (improved testing, memory guidance)
│  └─ NO → Defer (no functional impact, cosmetic only)
│
END: [ADOPT - zero risk, documentation-only enhancement]
```

**Criteria by Project Type**:

| Project Type | Adopt If | Defer If | Skip If |
|--------------|----------|----------|---------|
| **New Project** (generated from v1.9.3+) | Always | N/A | N/A |
| **Stable Project** (few customizations) | Immediately | N/A | Not using AI agents |
| **Customized Project** (extensive local changes) | If AGENTS.md not customized | If AGENTS.md heavily customized | Never (safe either way) |
| **Multi-Project Agent** (ecosystem consistency matters) | Always (consistency across projects) | N/A | N/A |

---

## What Changed

### Files Modified

**1. `template/AGENTS.md.jinja`**
   - **Lines changed**: +150 (3 new sections added)
   - **Change type**: Enhancement (documentation only)
   - **Displacement risk**: ZERO (append-only additions)
   - **Customization impact**: Unlikely to conflict (added at end of sections)
   - **What changed**:
     - Added "System-Level Validation (Super-Tests)" subsection in Testing Instructions
     - Added "Memory Architecture (3-Tier Model)" subsection in Agent Memory System
     - Added "Advanced Memory Query Patterns for Agents" subsection in Agent Memory System

**2. `CHANGELOG.md`**
   - **Lines changed**: +67 (new v1.9.3 release entry)
   - **Change type**: Documentation
   - **Note**: Final release before v2.0.0 refactoring

---

## What Was Added

### 1. Super-Tests Guidance (~50 lines)

**Location**: `template/AGENTS.md.jinja` → Testing Instructions → System-Level Validation (Super-Tests)

**What it documents**:
- Philosophy: Test workflows and system behavior, not just individual units
- When to write super-tests (pre-release, post-bugfix, integrations, critical journeys)
- Project-type-specific examples (MCP Server, CLI Tool, Web Service)
- Balance guidance: 70-80% unit tests, 20-30% super-tests

**Agent impact**: Agents now understand system-level validation patterns beyond unit testing

**Example content**:
```markdown
### System-Level Validation (Super-Tests)

**Philosophy:** Test workflows and system behavior, not just individual units.

Super-tests validate **end-to-end scenarios** that users actually experience...
```

**Benefits**:
- Guides agents to write holistic validation tests
- Prevents over-focus on unit test granularity
- Provides concrete examples per project type

---

### 2. Memory Architecture Overview (~40 lines)

**Location**: `template/AGENTS.md.jinja` → Agent Memory System → Memory Architecture (3-Tier Model)

**What it documents**:
- 3-tier memory model: Ephemeral → Persistent → Structured
- Visual ASCII diagram showing tier relationships
- Decision table: "When agents use each tier" (6 scenarios)
- Memory flow example: Task execution → Event emission → Pattern discovery → Knowledge creation

**Agent impact**: Agents understand when to use session memory vs. event log vs. knowledge graph

**Example content**:
```markdown
### Memory Architecture (3-Tier Model)

{{ project_name }} implements a **three-tier memory architecture** optimized for AI agent workflows:

```
┌──────────────────────────────────────────────────────────────┐
│ TIER 1: EPHEMERAL MEMORY (Session Context)                  │
├──────────────────────────────────────────────────────────────┤
│ • Agent's working memory within single conversation         │
...
```

**Benefits**:
- Clarifies memory tier purposes
- Provides decision framework for memory usage
- Demonstrates memory evolution patterns

---

### 3. Advanced Memory Query Patterns (~60 lines)

**Location**: `template/AGENTS.md.jinja` → Agent Memory System → Advanced Memory Query Patterns for Agents

**What it documents**:
- 5 production-ready query patterns with Python code examples:
  1. **Semantic Search** - Find similar problems by keyword extraction
  2. **Temporal Analysis** - Detect performance trends, identify degradation points
  3. **Confidence-Filtered Queries** - Apply only high-confidence solutions to production
  4. **Multi-Hop Knowledge Traversal** - Gather deep context via Zettelkasten links
  5. **Hybrid Query** - Combine events (what happened) with knowledge (what we learned)
- Decision table: "When to use which pattern"

**Agent impact**: Agents can use sophisticated memory queries beyond basic searches

**Example content**:
```python
# Pattern 1: Semantic Search
keywords = ["timeout", "database", "connection"]
similar_events = query_events(
    event_type="app.failed",
    since_hours=720,  # Last 30 days
    metadata_contains=keywords
)
```

**Benefits**:
- Provides actionable, copy-paste code examples
- Covers common scenarios (debugging, optimization, pattern discovery)
- Explains "why this works" for each pattern

---

## Migration Steps

### Step 1: Verify Current Version

```bash
# Check your template version
cat .copier-answers.yml | grep "_commit"
# Should show: _commit: <hash from v1.9.2>
```

### Step 2: Update from Template

```bash
# Standard copier update
copier update

# Answer prompts (or press Enter to keep existing values)
```

### Step 3: Review Changes

```bash
# See what changed
git diff AGENTS.md

# Expected: ~150 lines added in 3 sections
# No removals or modifications to existing content
```

### Step 4: Commit

```bash
# If satisfied, commit the upgrade
git add AGENTS.md .copier-answers.yml
git commit -m "chore: Upgrade chora-base template to v1.9.3

Adds enhanced agent guidance:
- Super-tests for system-level validation
- Memory architecture (3-tier model) documentation
- Advanced memory query patterns with examples"
```

---

## Testing After Upgrade

### Validation Checklist

- [ ] AGENTS.md exists and is readable
- [ ] No syntax errors in AGENTS.md
- [ ] New sections appear in expected locations:
  - [ ] "System-Level Validation (Super-Tests)" in Testing Instructions
  - [ ] "Memory Architecture (3-Tier Model)" in Agent Memory System
  - [ ] "Advanced Memory Query Patterns" in Agent Memory System
- [ ] Existing content unchanged (no regressions)

### Quick Test

```bash
# Verify AGENTS.md has new content
grep "System-Level Validation" AGENTS.md
grep "Memory Architecture (3-Tier Model)" AGENTS.md
grep "Advanced Memory Query Patterns" AGENTS.md

# All three greps should return results
```

---

## Rollback Instructions

### If Something Goes Wrong

```bash
# Rollback to v1.9.2
git checkout HEAD~1 AGENTS.md .copier-answers.yml

# Or regenerate from v1.9.2
copier copy --vcs-ref=v1.9.2 gh:your-org/chora-base .
```

**Note**: Rollback is essentially no-op (documentation-only changes have no side effects).

---

## Manual Merge (If AGENTS.md Customized)

### If You've Customized AGENTS.md

1. **Review the diff**:
   ```bash
   git diff v1.9.2..v1.9.3 template/AGENTS.md.jinja
   ```

2. **Identify additions** (3 new sections)

3. **Manually add sections** to your customized AGENTS.md:
   - Copy "System-Level Validation" section → paste after "Pre-Merge Verification"
   - Copy "Memory Architecture" section → paste after "Agent Memory System > Overview"
   - Copy "Advanced Memory Query Patterns" section → paste after "CLI Tools for Agents"

4. **Adjust for your project** (if needed - usually not necessary)

---

## Known Issues

**None** - Documentation-only release with no known issues.

---

## FAQ

**Q: Do I need to upgrade immediately?**
A: No urgency. This is documentation-only. Upgrade when convenient.

**Q: Will this break my existing code?**
A: No. Zero code changes, only AGENTS.md documentation enhancements.

**Q: What if I don't use AI agents?**
A: You can skip this upgrade. Benefits are primarily for AI-driven development.

**Q: Should I wait for v2.0.0 instead?**
A: v2.0.0 will be a structural refactoring (MAJOR version). If you want the enhancements now, adopt v1.9.3. v2.0.0 will include these enhancements in the new structure.

**Q: Will v2.0.0 break things?**
A: v2.0.0 will refactor AGENTS.md into nested files (research-aligned). It's a breaking structural change but not a functional change. See upcoming v1.9.3-to-v2.0.0 upgrade guide.

---

## Next Steps

**After upgrading to v1.9.3**:

1. **Review new agent guidance** in AGENTS.md
2. **Consider implementing super-tests** for critical workflows
3. **Try advanced memory patterns** if using A-MEM features
4. **Monitor announcements** for v2.0.0 (nested AGENTS.md refactoring)

**Coming in v2.0.0**:
- Nested AGENTS.md architecture (research-aligned)
- Modular structure: tests/AGENTS.md, .chora/memory/AGENTS.md, etc.
- "Nearest file wins" pattern for context-local documentation
- Main AGENTS.md reduced from 2,540 → 800 lines (discovery index)

---

## Support

**Issues?** https://github.com/your-org/chora-base/issues

**Questions?** See docs/upgrades/README.md for upgrade philosophy and common patterns.

---

**Upgrade Complete** ✅

Your project is now on v1.9.3 with enhanced agent guidance. Prepare for v2.0.0 structural refactoring in the next major release.
