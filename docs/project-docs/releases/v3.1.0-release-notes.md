# chora-base v3.1.0 Release Notes

**Release Date:** 2025-10-25
**Type:** Minor Release (Improvements)
**Theme:** Blueprint Simplification (Partial)

## Overview

chora-base v3.1.0 continues the AI-agent-first architecture from v3.0.0 by simplifying 3 core blueprint files, removing 37 Jinja2 conditionals (24% of total). This release demonstrates **pure `{{ variable }}` replacement** with zero conditionals in key configuration files.

**Scope:** Partial implementation of v3.1.0 plan. Complete README.md and AGENTS.md simplification deferred to v3.1.1 or v3.2.0.

## Changes

### Simplified Blueprints (37 Conditionals Removed)

#### 1. pyproject.toml.blueprint (13 → 0 conditionals) ✅

**Before (v3.0.0):**
```toml
{% if project_type == 'mcp_server' -%}
    "fastmcp>=0.3.0",
{% endif -%}
{% if include_cli -%}
{% if cli_framework == 'click' -%}
    "click>=8.0.0",
{% elif cli_framework == 'typer' -%}
    "typer>=0.9.0",
{% endif -%}
{% endif -%}
```

**After (v3.1.0):**
```toml
dependencies = [
    "fastmcp>=0.3.0",
    "pydantic>=2.0.0",
    "pydantic-settings>=2.0.0",
    "python-dotenv>=1.0.0",
    "click>=8.0.0",  # CLI framework - remove if not using CLI
]
```

**Changes:**
- All dependencies included by default
- Comments guide removal of unused deps
- 100% variable replacement success
- New variable: `python_version_nodots` (e.g., "312" for ruff/black config)

#### 2. server.py.blueprint (11 → 0 conditionals) ✅

**Before (v3.0.0):**
```python
{% if mcp_enable_namespacing -%}
from .mcp import make_tool_name, validate_tool_name
{% endif -%}

{% if mcp_enable_namespacing -%}
@mcp.tool()
async def example_tool(message: str) -> dict[str, Any]:
    tool_name = make_tool_name("example_tool")
    ...
{% else -%}
@mcp.tool()
async def example_tool(message: str) -> dict[str, Any]:
    # Non-namespaced version
    ...
{% endif -%}
```

**After (v3.1.0):**
```python
from .mcp import (
    NAMESPACE,
    make_tool_name,
    validate_tool_name,
    make_resource_uri,
    validate_resource_uri,
)

@mcp.tool()
async def example_tool(message: str) -> dict[str, Any]:
    """Example tool demonstrating namespaced naming.

    Tool name: {{ mcp_namespace }}:example_tool
    """
    tool_name = make_tool_name("example_tool")
    validate_tool_name(tool_name, expected_namespace=NAMESPACE)
    ...
```

**Changes:**
- Full MCP implementation with namespacing enabled
- All imports included
- All validation enabled
- Clean, production-ready code
- No feature toggles

#### 3. ROADMAP.md.blueprint (13 → 0 conditionals) ✅

**Before (v3.0.0):**
```markdown
{% if project_type == 'mcp_server' -%}
- [ ] **Core MCP Server** - Standard protocol implementation
{% elif project_type == 'library' -%}
- [ ] **Core API** - Essential functions/classes
{% elif project_type == 'cli_tool' -%}
- [ ] **Core Commands** - 3-5 essential commands
{% endif -%}
```

**After (v3.1.0):**
```markdown
- [ ] **Core MCP Server** - Standard protocol implementation
- [ ] **Essential Tools** - 3-5 high-value tools
- [ ] **Error Handling** - Robust error reporting
- [ ] **Documentation** - README, AGENTS.md, examples
- [ ] **Testing** - Unit tests with ≥{{ test_coverage_threshold }}% coverage
```

**Changes:**
- Comprehensive roadmap with all sections
- MCP server focus (primary use case)
- Vision docs section included
- Single complete template

### setup.py Enhancements

**New Variables:**
- `python_version_nodots`: Derived from `python_version` (e.g., "3.12" → "312")
  - Used in pyproject.toml for ruff/black target-version
- `test_coverage_threshold`: Default "85" (85% coverage requirement)
  - Used in pyproject.toml coverage config

**Improved Derivation:**
```python
# Derive additional variables
variables['python_version_nodots'] = variables['python_version'].replace('.', '')
variables['test_coverage_threshold'] = "85"  # Default 85% coverage
```

## Progress Summary

### Completed (v3.1.0)

| Blueprint | Before | After | Status |
|-----------|--------|-------|--------|
| pyproject.toml.blueprint | 13 conditionals | 0 | ✅ Complete |
| server.py.blueprint | 11 conditionals | 0 | ✅ Complete |
| ROADMAP.md.blueprint | 13 conditionals | 0 | ✅ Complete |
| **Subtotal** | **37 conditionals** | **0** | **100% success** |

### Remaining (Future)

| Blueprint | Conditionals | Deferred To |
|-----------|-------------|-------------|
| AGENTS.md.blueprint | 91 | v3.1.1 or v3.2.0 |
| README.md.blueprint | 27 | v3.1.1 or v3.2.0 |
| **Subtotal** | **118** | **Future release** |

### Overall Stats

- **Total conditionals (v3.0.0):** 157
- **Eliminated (v3.1.0):** 37 (24%)
- **Remaining:** 118 (76%)
- **Simplified blueprints:** 3 of 10 (30%)

## Benefits

### For AI Agents

**Simplified Processing:**
- 3 core blueprints require zero conditional logic
- Pure string replacement: `{{ variable }}` → value
- No Jinja2 knowledge needed for these files

**100% Variable Replacement:**
- pyproject.toml: All placeholders replaced
- server.py: All placeholders replaced
- ROADMAP.md: All placeholders replaced

### For Human Developers

**Clearer Templates:**
- See exactly what will be generated
- No "hidden" conditional logic
- Comments guide feature removal

**Easier Customization:**
- Delete unused features post-generation
- No need to understand Jinja2 syntax
- Straightforward file editing

## Migration from v3.0.0

### Automatic Upgrade

**No breaking changes!** Projects generated with v3.0.0 continue working.

**To use v3.1.0 improvements:**

```bash
cd /path/to/chora-base
git pull
git checkout v3.1.0

# Generate new project
python setup.py my-new-project
```

### Existing Projects

**Option 1: No Action Required**
- v3.0.0 projects work fine
- No urgent need to regenerate

**Option 2: Regenerate (Optional)**
- Generate fresh v3.1.0 project
- Copy your code into new structure
- Benefit: Cleaner pyproject.toml, server.py, ROADMAP.md

**Time Investment:** ~30 minutes to regenerate and merge code

## Testing

### Validation

✅ **Verified:**
- 0 Jinja2 conditionals in 3 blueprints (grep confirmed)
- setup.py correctly derives new variables
- All `{{ variable }}` placeholders remain intact
- No syntax errors in simplified blueprints

### Manual Review

- Reviewed pyproject.toml.blueprint: Complete, production-ready
- Reviewed server.py.blueprint: Full MCP server implementation
- Reviewed ROADMAP.md.blueprint: Comprehensive template

## Known Limitations

### Incomplete Simplification

**README.md.blueprint (27 conditionals):**
- Still contains project_type conditionals
- Deferred due to size/complexity (336 lines)
- Will be simplified in future release

**AGENTS.md.blueprint (91 conditionals):**
- Still contains extensive feature conditionals
- Deferred due to size/complexity (1,387 lines)
- Will be simplified in future release

### Workarounds

**For v3.1.0:**
- README.md and AGENTS.md still use Jinja2 conditionals
- AI agents must handle `{% if %}` blocks in these 2 files
- Other 8 blueprints work with pure variable replacement

**Recommendation:**
- Use v3.1.0 for improved core blueprints
- Accept conditional logic in README/AGENTS for now
- Await v3.1.1 or v3.2.0 for complete simplification

## What's Next

### v3.1.1 (Planned - Quick Follow-up)

**Focus:** Complete blueprint simplification

**Scope:**
- Simplify README.md.blueprint (27 → 0 conditionals)
- Simplify AGENTS.md.blueprint (91 → 0 conditionals)
- 100% pure `{{ variable }}` replacement achieved

**Estimated Release:** 2025-11-01 (1 week after v3.1.0)

### v3.2.0 (Planned - Enhanced Features)

**Focus:** Cross-platform support and tooling

**Scope:**
- Windows/Linux testing and fixes
- Template update helper script
- Feature removal helper script
- Performance optimization

**Estimated Release:** 2025-11-15 (3 weeks after v3.1.0)

## Resources

**Documentation:**
- [v3.0.0 Release Notes](v3.0.0-release-notes.md) - Original AI-agent-first architecture
- [README.md](../../README.md) - Updated for v3.1.0
- [CHANGELOG.md](../../CHANGELOG.md) - Full version history

**Code:**
- [blueprints/](../../blueprints/) - 3 simplified, 2 remaining
- [setup.py](../../setup.py) - Enhanced with new variables

**Support:**
- [GitHub Issues](https://github.com/liminalcommons/chora-base/issues)
- [GitHub Discussions](https://github.com/liminalcommons/chora-base/discussions)

## Acknowledgments

**v3.1.0 Development:**
- Partial implementation of full v3.1.0 plan
- Focused on highest-impact blueprints
- Pragmatic approach: Ship improvements incrementally

**Design Decision:**
- Ship 3 simplified blueprints now (v3.1.0)
- Complete remaining 2 blueprints later (v3.1.1)
- Better than waiting for 100% completion

---

**Status:** Partial implementation of v3.1.0 plan
**Completion:** 3 of 5 blueprint simplifications (60%)
**Next Release:** v3.1.1 will complete the remaining 2 blueprints
