# chora-base v2.1.0 Release Notes

**Release Date:** 2025-10-24
**Type:** Minor Release (Feature Addition)
**Status:** Ready for Production

---

## 🎉 What's New: Production-Ready Python Utilities

chora-base v2.1.0 introduces **optional Python utilities** that provide production-ready patterns extracted from real-world adopter learnings. These utilities reduce boilerplate code by 40-50% while improving code quality and user experience.

### Key Features

**4 New Utility Modules:**
1. **Input Validation** - Normalize dict/JSON/KV parameters (~90% less boilerplate)
2. **Response Standardization** - Consistent API responses (~80-85% reduction)
3. **Error Formatting** - User-friendly messages with fuzzy matching
4. **State Persistence** - Crash-safe JSON storage (~70-75% reduction)

**Comprehensive Documentation:**
- 1 complete API reference guide
- 4 task-oriented how-to guides
- AGENTS.md integration for AI agents
- Adopter learnings documentation

---

## 🚀 Quick Start

### For New Projects

Generate a project with utilities:

```bash
copier copy gh:chrishayuk/chora-base my-project
# Answer prompts, utilities enabled by default for MCP/library projects
```

### For Existing Projects

Update your project to v2.1.0:

```bash
copier update
# Review changes, utilities are optional (controlled by flags)
```

### Example Usage

```python
from myapp.utils.validation import normalize_input, InputFormat
from myapp.utils.responses import Response
from myapp.utils.errors import ErrorFormatter

@normalize_input(params=InputFormat.DICT_OR_JSON)
def create_resource(name: str, params: dict | None = None):
    """Create a resource with input validation."""
    params = params or {}

    # Input automatically normalized from dict or JSON string
    return Response.success(action="created", data={"name": name})

def get_resource(resource_id: str):
    """Get resource with helpful errors."""
    if resource_id not in resources:
        error_msg = ErrorFormatter.not_found(
            entity_type="resource",
            entity_id=resource_id,
            available=list(resources.keys()),
        )
        return Response.error(error_code="not_found", message=error_msg)
```

---

## 📊 Impact & Benefits

### Code Reduction

| Pattern | Before | After | Reduction |
|---------|--------|-------|-----------|
| Input validation | 20 lines | 1 line | ~90% |
| Response building | 10-15 lines | 2-3 lines | ~80-85% |
| State persistence | 25-30 lines | 7-8 lines | ~70-75% |
| **Combined** | **150-200 lines** | **60-80 lines** | **40-50%** |

### Quality Improvements

✅ **Consistency** - Standardized patterns across all endpoints
✅ **Reliability** - Atomic writes, type safety, comprehensive tests
✅ **User Experience** - Fuzzy matching suggestions, helpful errors
✅ **Maintainability** - Centralized logic, less code to maintain

---

## 🎯 Who Should Use This?

### Perfect For:
- **MCP Server developers** - Reduce boilerplate in tool implementations
- **API developers** - Consistent REST/RPC endpoints
- **CLI tool creators** - Structured output and error handling
- **Library authors** - Standard response/error patterns

### When to Skip:
- Simple scripts (<100 lines)
- Prototypes (can add later)
- Frameworks with equivalent features (FastAPI validation, etc.)

---

## 📚 Documentation

### Getting Started
- **Reference Guide:** `template/user-docs/reference/python-patterns.md`
  - Complete API documentation
  - When to use each pattern
  - Performance and security considerations

### Task-Oriented Guides
- **Input Validation:** `template/user-docs/how-to/use-input-validation.md`
- **Response Standardization:** `template/user-docs/how-to/standardize-responses.md`
- **Error Formatting:** `template/user-docs/how-to/improve-error-messages.md`
- **State Persistence:** `template/user-docs/how-to/persist-application-state.md`

### For AI Agents
- **Quick Reference:** `template/AGENTS.md` - "Python Utilities" section
  - Copy-paste examples
  - Decision guide (when to use/skip)
  - Links to complete documentation

### Background & Attribution
- **Adopter Learnings:** `docs/research/adopter-learnings-mcp-orchestration.md`
  - Pattern extraction process
  - Source attribution (mcp-orchestration v0.1.3)
  - Generalization methodology

---

## 🔧 Configuration

### Copier Flags

Control utility generation with these flags:

```yaml
include_api_utilities:
  type: bool
  default: true  # For MCP/library projects
  # Generates: validation.py, responses.py, errors.py

include_persistence_helpers:
  type: bool
  default: false  # Opt-in
  # Generates: persistence.py
```

### Generated Files

**When `include_api_utilities: true`:**
- `src/{package}/utils/validation.py`
- `src/{package}/utils/responses.py`
- `src/{package}/utils/errors.py`
- `tests/utils/test_validation.py`
- `tests/utils/test_responses.py`
- `tests/utils/test_errors.py`
- `user-docs/how-to/use-input-validation.md`
- `user-docs/how-to/standardize-responses.md`
- `user-docs/how-to/improve-error-messages.md`

**When `include_persistence_helpers: true`:**
- `src/{package}/utils/persistence.py`
- `tests/utils/test_persistence.py`
- `user-docs/how-to/persist-application-state.md`

**Always when utilities enabled:**
- `src/{package}/utils/__init__.py`
- `user-docs/reference/python-patterns.md`
- AGENTS.md section

---

## ✅ Testing & Validation

### Test Coverage
- ✅ 112+ test cases across 4 modules
- ✅ 95-100% code coverage
- ✅ Edge cases and error conditions

### Generalization Validation
Tested across 5 project types:
- ✅ MCP servers (original use case)
- ✅ REST APIs
- ✅ CLI tools
- ✅ Python libraries
- ✅ Microservices

### Dependencies
- ✅ Python stdlib only (no external dependencies)
- ✅ Compatible with Python 3.11+
- ✅ Works with sync and async functions

---

## 🔄 Migration Guide

### From v2.0.x to v2.1.0

**No breaking changes** - This is a feature addition release.

**For existing projects:**

1. **Update template:**
   ```bash
   copier update
   ```

2. **Review new flags:**
   - `include_api_utilities` (default: true for MCP/library)
   - `include_persistence_helpers` (default: false)

3. **Choose adoption strategy:**
   - **Option A:** Enable utilities, refactor existing code gradually
   - **Option B:** Disable utilities, keep existing patterns
   - **Option C:** Enable for new code only

4. **If adopting utilities:**
   - Read `user-docs/reference/python-patterns.md`
   - Start with one pattern at a time
   - Refactor existing code incrementally
   - Run tests after each change

**Recommended approach:**
```python
# Start with response standardization (easiest)
from myapp.utils.responses import Response

# Convert one endpoint
@app.get("/api/resources")
def list_resources():
    return Response.success(action="listed", data=get_all())  # New
    # return {"resources": get_all()}  # Old

# Gradually adopt other patterns
```

---

## 📖 Examples

### REST API Example

```python
from myapp.utils.validation import normalize_input, InputFormat
from myapp.utils.responses import Response
from myapp.utils.errors import ErrorFormatter

@app.post("/api/servers")
@normalize_input(config=InputFormat.DICT_OR_JSON)
def create_server(name: str, config: dict | None = None):
    """Create a server."""
    # Validate
    if name in servers:
        return Response.error(
            error_code="already_exists",
            message=ErrorFormatter.already_exists("server", name),
        )

    # Create
    server = create_new_server(name, config)

    return Response.success(action="created", data=server)
```

### CLI Tool Example

```python
import click
from myapp.utils.responses import Response
from myapp.utils.errors import ErrorFormatter

@click.command()
@click.argument('server_id')
def get(server_id: str):
    """Get server by ID."""
    if server_id not in servers:
        error_msg = ErrorFormatter.not_found(
            entity_type="server",
            entity_id=server_id,
            available=list(servers.keys()),
        )
        result = Response.error("not_found", error_msg)
    else:
        result = Response.success("retrieved", servers[server_id])

    click.echo(json.dumps(result, indent=2))
```

### MCP Server Example

```python
from myapp.utils.validation import normalize_input, InputFormat
from myapp.utils.responses import Response
from myapp.utils.persistence import StatefulObject

class DraftManager(StatefulObject):
    """Manage draft server configurations."""

    def __init__(self):
        super().__init__(state_file="~/.mcp/drafts.json")
        self.drafts = getattr(self, 'drafts', {})

@mcp.tool()
@normalize_input(params=InputFormat.DICT_OR_JSON)
async def save_draft(server_id: str, params: dict | None = None):
    """Save draft configuration."""
    draft_manager.drafts[server_id] = params
    draft_manager._save_state()  # Atomic write

    return Response.success(action="drafted", data={"server_id": server_id})
```

---

## 🙏 Attribution

These utilities were extracted from learnings shared by the **mcp-orchestration** project (v0.1.3). The patterns were generalized from MCP-specific use cases to universal Python patterns applicable across all project types.

**Source:** [mcp-orchestration](https://github.com/chrishayuk/mcp-orchestration)

**Knowledge Transfer:**
- 8 documents (~4,644 lines) provided by mcp-orchestration team
- Patterns extracted and validated across 5 project types
- Complete attribution in `docs/research/adopter-learnings-mcp-orchestration.md`

**Thank you to the mcp-orchestration team for sharing their learnings!**

---

## 📈 Project Metrics

### Implementation
- 6-week development project
- 27 files created/updated
- ~12,990 lines (code + tests + docs)
- 112+ test cases
- 95-100% test coverage

### Impact
- 40-50% code reduction (all patterns combined)
- Better user experience (error suggestions)
- Production-ready reliability (atomic writes)
- Stdlib-only (zero dependencies)

---

## 🐛 Known Issues

None at release time.

**If you encounter issues:**
1. Check documentation: `user-docs/reference/python-patterns.md`
2. Review troubleshooting sections in how-to guides
3. Report issues: https://github.com/chrishayuk/chora-base/issues

---

## 🔮 Future Work

### Potential Additional Patterns (v2.2.0+)

Based on the full knowledge base, these patterns identified for future extraction:

1. **Transport Abstraction** - Protocol adapters (STDIO/HTTP/SSE)
2. **Structured Logging** - Context-aware logging with correlation IDs
3. **Configuration Validation** - Schema validation with helpful errors

**Timeline:** Under consideration for Q1 2026

### Feedback Welcome

We'd love to hear how you're using the utilities:
- What patterns are most valuable?
- What additional patterns would help?
- What documentation could be improved?

---

## 📝 Upgrade Instructions

### Standard Upgrade

```bash
# Navigate to your chora-base project
cd my-project

# Update from template
copier update

# Review changes
git diff

# Run tests to verify
pytest

# Commit if all looks good
git add .
git commit -m "chore: upgrade to chora-base v2.1.0"
```

### Selective Adoption

If you want utilities but have customizations:

```bash
# Update with interactive mode
copier update --vcs-ref v2.1.0

# Or cherry-pick utility files manually
# See "Files Added" section in CHANGELOG
```

---

## 🎯 Next Steps

1. **Read the documentation**
   - Start with `user-docs/reference/python-patterns.md`
   - Review how-to guides for your use case

2. **Try one pattern**
   - Start with Response standardization (easiest)
   - Apply to one endpoint/function
   - Verify tests pass

3. **Gradually adopt**
   - Add more patterns as needed
   - Refactor existing code incrementally
   - Measure impact on your codebase

4. **Share feedback**
   - Report issues or suggestions
   - Share success stories
   - Contribute improvements

---

**Release v2.1.0 - Production-Ready Python Utilities**
**chora-base: Python Project Template for LLM-Intelligent Development**

---

**Links:**
- Repository: https://github.com/chrishayuk/chora-base
- Documentation: `template/user-docs/`
- Issues: https://github.com/chrishayuk/chora-base/issues
- Changelog: [CHANGELOG.md](../../CHANGELOG.md)

**Released:** 2025-10-24
**Authors:** chora-base core team + mcp-orchestration contributors
