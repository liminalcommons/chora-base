# Upgrading from v1.1.1 to v1.2.0

**Release Date**: 2025-10-18
**Template Version**: v1.1.1 → v1.2.0
**Upgrade Effort**: 1-2 hours
**For**: Human developers, AI coding agents

---

## Quick Assessment

| Aspect | Value |
|--------|-------|
| **Effort** | 1-2 hours |
| **Breaking Changes** | No (but critical fixes affecting customized files) |
| **Required For** | Correctness (ImportError fixes), generalization (remove hard coded refs) |
| **Can Skip If** | NOT using memory system AND no hardcoded paths in scripts |
| **Displacement Risk** | HIGH (fixes touch customizable files) |
| **Agent Autonomy** | 40% (requires merge strategy decisions) |

---

## TL;DR

**What's New**:
- CRITICAL: ImportError fixes in memory module (2 files converted to .jinja)
- CRITICAL: Hardcoded paths removed from scripts (3 scripts fixed)
- CRITICAL: Placeholder fixes (GitHub usernames, security email)
- HIGH: Memory README generalized (6 project-specific references removed)

**Impact on Existing Adopters**:
- IF using memory system: **REQUIRED upgrade** (ImportError would crash at runtime)
- IF customized scripts: **Review merge** (template removes hardcoded paths)
- IF customized memory module: **Merge carefully** (template fixes imports)

**Recommended Action**:
- **For memory system projects**: Upgrade REQUIRED (correctness)
- **For all projects**: Recommended (generalization improvements)
- **Merge strategy**: Preserve customizations, apply template fixes

---

## Decision Tree for AI Agents

```
START

├─ Does project use memory system?
│  ├─ YES → Upgrade REQUIRED (ImportError fixes)
│  │         ├─ Have customizations in memory/__init__.py or trace.py?
│  │         │  ├─ YES → MERGE STRATEGY (see Conflict Resolution)
│  │         │  └─ NO → Safe to adopt (copier update)
│  └─ NO → Continue evaluation
│
├─ Have customized scripts (check-env.sh, mcp-tool.sh, handoff.sh)?
│  ├─ YES → Review merge (template removes hardcoded paths)
│  └─ NO → Safe to adopt
│
├─ Have placeholders in CONTRIBUTING.md (security@example.com)?
│  ├─ YES → Upgrade beneficial (fixes placeholders)
│  └─ NO → Already fixed manually
│
END: REQUIRED for memory projects, RECOMMENDED for all
```

**Criteria by Project Type**:

| Project Type | Adopt If | Defer If | Skip If |
|--------------|----------|----------|---------|
| **With Memory System** | Always (ImportError fix) | Never | Never |
| **Customized Scripts** | Review conflicts first | Heavy customization | N/A |
| **With Placeholders** | Clean up placeholders | Already fixed | N/A |
| **Stable Production** | Test in staging first | N/A | Never using features|

---

## What Changed

### Files Added

**New Documentation**:
1. `docs/GENERALIZATION_AUDIT_2025-10-18.md` (368 lines)
   - Complete audit of all 35 template files
   - 47 issues identified (18 fixed in v1.2.0)
   - Remaining issues documented for future releases

### Files Renamed/Modified (Python Source)

**CRITICAL CHANGES** (2 files):

1. `template/src/{{package_name}}/memory/__init__.py` → `__init__.py.jinja`
   - **Lines changed**: +4 -4
   - **Change type**: Fix (ImportError)
   - **Displacement risk**: HIGH (file you may have customized)
   - **Customization impact**: LIKELY conflict if memory system customized
   - **Diff summary**:
     ```diff
     - from mcp_n8n.memory.event_log import EventLog
     - from mcp_n8n.memory.knowledge_graph import KnowledgeGraph
     + from {{ package_name }}.memory.event_log import EventLog
     + from {{ package_name }}.memory.knowledge_graph import KnowledgeGraph
     ```

2. `template/src/{{package_name}}/memory/trace.py` → `trace.py.jinja`
   - **Lines changed**: +1 -1
   - **Change type**: Fix (hardcoded source)
   - **Displacement risk**: MEDIUM (less likely to customize)
   - **Diff summary**:
     ```diff
     - source: str = "mcp-n8n"
     + source: str = "{{ project_slug }}"
     ```

### Files Modified (Scripts)

**CRITICAL CHANGES** (3 scripts):

3. `template/scripts/check-env.sh.jinja`
   - **Lines changed**: +3 -26
   - **Change type**: Fix (removed hardcoded backend checks)
   - **Displacement risk**: HIGH (script likely customized)
   - **Diff summary**:
     ```diff
     - # Check backend dependencies
     - CHORA_PATH="/Users/victorpiper/code/chora-compose"
     - CODA_PATH="/Users/victorpiper/code/mcp-server-coda"
     - [... specific validation logic ...]

     + # Add your project-specific dependency checks here
     + echo "✓ No additional dependencies to check"
     ```

4. `template/scripts/mcp-tool.sh.jinja`
   - **Lines changed**: +3 -2
   - **Change type**: Fix (dynamic path detection)
   - **Diff summary**:
     ```diff
     - MCP_DIR="/Users/victorpiper/code/{{ project_slug }}"
     + SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
     + MCP_DIR="$(dirname "$SCRIPT_DIR")"
     ```

5. `template/scripts/handoff.sh.jinja`
   - **Lines changed**: +3 -3
   - **Change type**: Fix (generic paths)
   - **Diff summary**:
     ```diff
     - /Users/victorpiper/code/chora-compose
     - /Users/victorpiper/code/mcp-server-coda
     + /path/to/backend-service
     + /path/to/other-dependency
     ```

**CRITICAL CHANGES** (Documentation):

6. `template/CONTRIBUTING.md.jinja`
   - **Lines changed**: +3 -3
   - **Change type**: Fix (placeholder GitHub username, security email)
   - **Diff summary**:
     ```diff
     - https://github.com/yourusername/{{ project_slug }}/...
     + https://github.com/{{ github_username }}/{{ project_slug }}/...

     - contact the maintainers at security@example.com
     + contact the maintainers at {{ security_email }}
     ```

7. `template/scripts/publish-prod.sh.jinja`
   - **Lines changed**: +1 -1
   - **Diff summary**:
     ```diff
     - https://github.com/yourusername/{{ project_slug }}
     + https://github.com/{{ github_username }}/{{ project_slug }}
     ```

8. `template/scripts/diagnose.sh.jinja`
   - **Lines changed**: +1 -1
   - **Diff summary** (same as publish-prod.sh)

**HIGH PRIORITY CHANGES** (Memory docs):

9. `template/.chora/memory/README.md.jinja`
   - **Lines changed**: +11 -11
   - **Change type**: Fix (project-specific references → generic)
   - **Displacement risk**: LOW (documentation file)
   - **6 changes**:
     - `mcp-n8n` → `{{ project_slug }}`
     - `chora:*`, `chora-composer` → `example:*`, `example-backend`
     - Version refs → generic `{{ project_version }}`

### Configuration Changes

10. `copier.yml`
    - **Lines changed**: +9 -0
    - **Change type**: New variable (`security_email`)
    - **Displacement risk**: NONE (new variable)
    - **Diff**:
      ```yaml
      + security_email:
      +   type: str
      +   help: Email for security vulnerability reports
      +   default: "{{ author_email }}"
      +   validator: >-
      +     {% if not (security_email | regex_search('^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$')) %}
      +     Must be valid email address
      +     {% endif %}
      ```

---

## Displacement Analysis

### Type 1: Required (Correctness Fixes)

#### Fix 1: Python ImportError in Memory Module

**Files**: `memory/__init__.py`, `memory/trace.py`

**Problem**: Generated projects would crash at runtime with `ImportError: No module named 'mcp_n8n'`

**Fix**: Convert to `.jinja`, use `{{ package_name }}` and `{{ project_slug }}` variables

**Impact**: **MUST upgrade if using memory system**

**Merge Strategy**:
1. If you've **NOT customized** memory module → Accept template fix (safe)
2. If you've **customized** memory module → Merge:
   - Apply template's import fixes
   - Preserve your custom logic
   - See "Conflict Resolution" section below

#### Fix 2: Hardcoded Paths in Scripts

**Files**: `check-env.sh`, `mcp-tool.sh`, `handoff.sh`

**Problem**: Scripts fail for all users except original developer

**Fix**: Remove hardcoded `/Users/victorpiper/code/*` paths, use dynamic detection or generic placeholders

**Impact**: **Recommended for correctness**

**Merge Strategy**:
1. If you've **NOT customized** scripts → Accept template fix (safe)
2. If you've **customized** scripts (likely!) → Merge:
   - Remove hardcoded paths from template
   - Keep your custom validation logic
   - See "Conflict Resolution" section below

### Type 2: Optional (Generalization Improvements)

#### Improvement 1: Placeholder Fixes

**Files**: `CONTRIBUTING.md`, `publish-prod.sh`, `diagnose.sh`

**Changes**: `yourusername` → `{{ github_username }}`, `security@example.com` → `{{ security_email }}`

**Impact**: Cleaner generated projects

**Decision**: Adopt (no downside)

#### Improvement 2: Memory README Generalization

**File**: `.chora/memory/README.md`

**Changes**: Project-specific examples → generic examples

**Impact**: Documentation more applicable to all projects

**Decision**: Adopt if using memory system

### Type 3: Additive (Safe Enhancements)

#### Addition 1: Generalization Audit Documentation

**File**: `docs/GENERALIZATION_AUDIT_2025-10-18.md`

**Purpose**: Documents all generalization issues found, fixes applied

**Impact**: None (chora-base repo only)

**Decision**: N/A (not in generated projects)

#### Addition 2: Security Email Variable

**File**: `copier.yml` (new variable)

**Purpose**: Configurable security contact email

**Impact**: New prompt during upgrade

**Decision**: Adopt (provides default from `author_email`)

---

## Upgrade Steps

### Prerequisites

```bash
# 1. Ensure clean git state
git status
# CRITICAL: Must be clean before upgrading (merge conflicts expected)

# 2. Create backup
git branch backup-pre-upgrade-v1.2.0
git tag backup-v1.1.1

# 3. Review current customizations
git diff $(git log --diff-filter=A --format="%H" -n 1 .copier-answers.yml) HEAD

# CRITICAL: Document customizations in affected files
# - src/{{ package_name }}/memory/__init__.py
# - src/{{ package_name }}/memory/trace.py
# - scripts/check-env.sh
# - scripts/mcp-tool.sh
# - scripts/handoff.sh

# 4. Test current state
pytest
./scripts/check-env.sh
# Ensure all passing before upgrade
```

### Automated Upgrade

```bash
# Update to v1.2.0
copier update --vcs-ref v1.2.0 --trust

# You'll be prompted for new variable:
# security_email: [defaults to author_email]
# Choose: Press Enter to accept default OR enter custom email

# Expected: Copier will show CONFLICTS in customized files
```

### Manual Conflict Resolution

**Conflicts are EXPECTED in this upgrade** if you've customized affected files.

#### Conflict 1: memory/__init__.py (ImportError Fix)

**Template Change**:
```python
# File renamed: __init__.py → __init__.py.jinja
from {{ package_name }}.memory.event_log import EventLog
from {{ package_name }}.memory.knowledge_graph import KnowledgeGraph
```

**Your Customization** (example):
```python
from mcp_n8n.memory.event_log import EventLog  # OLD (wrong!)
from mcp_n8n.memory.knowledge_graph import KnowledgeGraph

# Custom trace configuration
TRACE_ENABLED = True
DEFAULT_TRACE_LEVEL = "INFO"
```

**Merge Strategy**:
1. Accept template's import fixes (REQUIRED for correctness)
2. Preserve your custom configuration
3. Combined result:
   ```python
   # Template imports (FIXED)
   from {{ package_name }}.memory.event_log import EventLog
   from {{ package_name }}.memory.knowledge_graph import KnowledgeGraph

   # Your custom configuration (PRESERVED)
   TRACE_ENABLED = True
   DEFAULT_TRACE_LEVEL = "INFO"
   ```

**Validation**:
```bash
# Ensure imports work
python -c "from {{ package_name }}.memory import EventLog, KnowledgeGraph"
# Should succeed (no ImportError)
```

#### Conflict 2: memory/trace.py (Source String)

**Template Change**:
```python
# File renamed: trace.py → trace.py.jinja
source: str = "{{ project_slug }}"  # Was: "mcp-n8n"
```

**Your Customization** (example):
```python
source: str = "mcp-n8n"  # OLD

# Custom trace ID format
def generate_trace_id() -> str:
    return f"custom-{uuid.uuid4()}"
```

**Merge Strategy**:
1. Accept template's `source` fix
2. Preserve custom trace ID logic
3. Combined result:
   ```python
   source: str = "{{ project_slug }}"  # FIXED

   # Your custom function (PRESERVED)
   def generate_trace_id() -> str:
       return f"custom-{uuid.uuid4()}"
   ```

**Validation**:
```bash
# Test trace context
python -c "from {{ package_name }}.memory.trace import TraceContext; print(TraceContext().source)"
# Should print your project slug
```

#### Conflict 3: scripts/check-env.sh (Hardcoded Backend Checks)

**Template Change**:
```bash
# Removed:
# CHORA_PATH="/Users/victorpiper/code/chora-compose"
# CODA_PATH="/Users/victorpiper/code/mcp-server-coda"
# [... validation logic ...]

# Added:
# Add your project-specific dependency checks here
echo "✓ No additional dependencies to check"
```

**Your Customization** (example):
```bash
# Backend checks
CHORA_PATH="/Users/victorpiper/code/chora-compose"
if [ ! -d "$CHORA_PATH" ]; then
    echo "❌ chora-compose not found"
    exit 1
fi

# Your custom API key check
if [ -z "$ANTHROPIC_API_KEY" ]; then
    echo "❌ ANTHROPIC_API_KEY not set"
    exit 1
fi
```

**Merge Strategy**:
1. Remove hardcoded paths (template fix)
2. Keep your custom validation logic with dynamic detection
3. Combined result:
   ```bash
   # Template fix: Dynamic backend detection (NO hardcoded paths)
   CHORA_PATH="${CHORA_COMPOSE_PATH:-../chora-compose}"  # Env var or relative
   if [ ! -d "$CHORA_PATH" ]; then
       echo "ℹ chora-compose not found at $CHORA_PATH (set CHORA_COMPOSE_PATH if needed)"
       # Don't exit - make it optional
   fi

   # Your custom validation (PRESERVED, improved)
   if [ -z "$ANTHROPIC_API_KEY" ]; then
       echo "❌ ANTHROPIC_API_KEY not set"
       exit 1
   fi
   ```

**Validation**:
```bash
./scripts/check-env.sh
# Should run without errors, check for your custom validations
```

#### Conflict 4: scripts/mcp-tool.sh (Hardcoded MCP Directory)

**Template Change**:
```bash
# Before:
# MCP_DIR="/Users/victorpiper/code/{{ project_slug }}"

# After:
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
MCP_DIR="$(dirname "$SCRIPT_DIR")"
```

**Your Customization** (example):
```bash
MCP_DIR="/Users/victorpiper/code/my-project"  # OLD

# Your custom MCP test
mcp-test --tool my_custom_tool
```

**Merge Strategy**:
1. Accept template's dynamic path detection
2. Keep your custom test logic
3. Combined result:
   ```bash
   # Template fix: Dynamic detection (NO hardcoded path)
   SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
   MCP_DIR="$(dirname "$SCRIPT_DIR")"

   # Your custom test (PRESERVED)
   mcp-test --tool my_custom_tool
   ```

**Validation**:
```bash
./scripts/mcp-tool.sh --examples
# Should work from any directory
```

#### Conflict 5: CONTRIBUTING.md (Placeholders)

**Template Change**:
```markdown
<!-- Before -->
https://github.com/yourusername/{{ project_slug }}/issues
Contact: security@example.com

<!-- After -->
https://github.com/{{ github_username }}/{{ project_slug }}/issues
Contact: {{ security_email }}
```

**Your Customization** (example):
```markdown
<!-- You may have already fixed this manually -->
https://github.com/myorg/my-project/issues
Contact: security@myorg.com

<!-- Plus custom contribution guidelines -->
## Custom Review Process
[your process]
```

**Merge Strategy**:
1. If you already fixed placeholders → Keep your values (template change redundant)
2. If you haven't → Accept template fix
3. Always preserve custom sections

**Validation**:
```bash
# Check for remaining placeholders
grep -i "yourusername\|security@example.com" CONTRIBUTING.md
# Should return no results
```

---

## Validation Checklist

### Core Functionality (CRITICAL)

- [ ] **Memory system imports work**:
  ```bash
  python -c "from {{ package_name }}.memory import EventLog, KnowledgeGraph, TraceContext"
  # Should succeed (no ImportError)
  ```

- [ ] **Scripts execute without hardcoded paths**:
  ```bash
  ./scripts/check-env.sh    # Should not reference /Users/victorpiper/
  ./scripts/mcp-tool.sh     # Should detect directory dynamically
  ./scripts/handoff.sh      # Should use generic paths or env vars
  ```

- [ ] **Tests pass**:
  ```bash
  pytest
  # All tests should pass (no regressions from merge)
  ```

### Template Integration

- [ ] `.copier-answers.yml` shows `_commit: v1.2.0`
- [ ] `security_email` set in `.copier-answers.yml`
- [ ] Memory module files are `.jinja` (not `.py`)
- [ ] No placeholder emails in CONTRIBUTING.md
- [ ] No `yourusername` in generated URLs

### Customizations Preserved

- [ ] Memory module customizations still work:
  ```bash
  # Test your custom memory code
  python -c "from {{ package_name }}.memory import [your_custom_function]"
  ```

- [ ] Script customizations still work:
  ```bash
  # Test your custom validation in check-env.sh
  ./scripts/check-env.sh | grep "YOUR_CUSTOM_CHECK"
  ```

- [ ] CONTRIBUTING.md custom sections intact

### Quality Gates

- [ ] Pre-commit hooks pass: `pre-commit run --all-files`
- [ ] Linting passes: `ruff check .`
- [ ] Type checking passes: `mypy src/`
- [ ] Coverage maintained: `pytest --cov`

---

## Example Upgrade Session

```bash
# Starting state (v1.1.1 project with customized memory module and scripts)
$ cat .copier-answers.yml | grep _commit
_commit: v1.1.1

$ git status
On branch main
nothing to commit, working tree clean

# Document customizations
$ cat UPGRADING.md
## Customized Files
- src/my_package/memory/__init__.py: Added TRACE_ENABLED config
- scripts/check-env.sh: Added ANTHROPIC_API_KEY validation

# Create backup
$ git branch backup-pre-upgrade-v1.2.0
$ git tag backup-v1.1.1

# Test current state
$ pytest
===== 42 passed in 3.14s =====

$ python -c "from mcp_n8n.memory import EventLog"  # OLD import (will break!)
# Currently works (but shouldn't - hardcoded wrong package!)

# Run upgrade
$ copier update --vcs-ref v1.2.0 --trust

[copier prompts]
security_email (Email for security vulnerability reports): [your.email@example.com]
# Press Enter to use author_email default OR enter custom

[copier shows conflicts]
Conflict in src/my_package/memory/__init__.py
Conflict in scripts/check-env.sh

# Review conflicts
$ git status
On branch main
Changes not staged for commit:
  modified:   .copier-answers.yml
  renamed:    src/my_package/memory/__init__.py -> src/my_package/memory/__init__.py.jinja
  renamed:    src/my_package/memory/trace.py -> src/my_package/memory/trace.py.jinja
  modified:   scripts/check-env.sh
  modified:   scripts/mcp-tool.sh
  modified:   CONTRIBUTING.md

# Resolve Conflict 1: memory/__init__.py
$ cat src/my_package/memory/__init__.py.jinja
<<<<<<< HEAD
from mcp_n8n.memory.event_log import EventLog  # OLD (wrong!)
TRACE_ENABLED = True  # My customization
=======
from {{ package_name }}.memory.event_log import EventLog  # FIXED
>>>>>>> copier-update

# Manually merge:
$ nano src/my_package/memory/__init__.py.jinja
# Result:
from {{ package_name }}.memory.event_log import EventLog  # FIXED
TRACE_ENABLED = True  # My customization preserved

# Resolve Conflict 2: scripts/check-env.sh
# Similar merge process - remove hardcoded paths, keep custom validation

# Test after merge
$ pytest
===== 42 passed in 3.14s =====

$ python -c "from my_package.memory import EventLog"  # NEW import (correct!)
# Success!

$ ./scripts/check-env.sh
✓ Python 3.11.5
✓ Dependencies installed
✓ ANTHROPIC_API_KEY set (my custom check)

# Commit upgrade
$ git add .
$ git commit -m "chore: Upgrade to chora-base v1.2.0

- Updated from v1.1.1 to v1.2.0
- CRITICAL: Fixed ImportError in memory module
- CRITICAL: Removed hardcoded paths from scripts
- Fixed placeholder emails and GitHub usernames
- Merged template fixes with customizations:
  - memory/__init__.py: Applied import fix, preserved TRACE_ENABLED
  - check-env.sh: Removed hardcoded CHORA_PATH, kept API key validation
- All tests passing

See docs/upgrades/v1.1-to-v1.2.md for details"

$ git log --oneline -1
h8i9j0k chore: Upgrade to chora-base v1.2.0
```

---

## Rollback Procedure

**If upgrade fails or causes runtime errors**:

```bash
# CRITICAL: Test imports immediately after upgrade
python -c "from {{ package_name }}.memory import EventLog"
# If this fails, rollback immediately

# Option 1: Rollback commit
git reset --hard HEAD~1

# Option 2: Restore from backup branch
git checkout main
git reset --hard backup-pre-upgrade-v1.2.0

# Option 3: Restore from tag
git checkout main
git reset --hard backup-v1.1.1

# Verify rollback
cat .copier-answers.yml | grep _commit
# Should show v1.1.1

# Test
pytest
python -c "from mcp_n8n.memory import EventLog"  # OLD import should work again
```

**Report issues**:
- GitHub: https://github.com/liminalcommons/chora-base/issues/new
- Include:
  - Version numbers (v1.1.1 → v1.2.0)
  - Merge conflict details
  - Customizations involved
  - Error messages (especially ImportError)

---

## Common Issues

### Issue 1: ImportError After Upgrade

**Symptom**:
```python
ImportError: No module named 'mcp_n8n'
```

**Cause**: Merge conflict not resolved, old imports still present

**Solution**:
```bash
# Search for old imports
grep -r "from mcp_n8n" src/

# Should find NONE (all should be {{ package_name }})

# If found, replace manually:
sed -i 's/from mcp_n8n/from {{ package_name }}/g' src/my_package/memory/__init__.py.jinja

# Test
python -c "from {{ package_name }}.memory import EventLog"
```

### Issue 2: Scripts Fail with "Directory Not Found"

**Symptom**:
```
check-env.sh: line 42: /Users/victorpiper/code/chora-compose: No such file or directory
```

**Cause**: Hardcoded path not removed, merge incomplete

**Solution**:
```bash
# Find hardcoded paths
grep -r "/Users/victorpiper" scripts/

# Should find NONE

# If found, replace with dynamic detection:
# Before:
BACKEND_PATH="/Users/victorpiper/code/backend"

# After:
BACKEND_PATH="${BACKEND_PATH:-../backend}"  # Env var or relative path
```

### Issue 3: Copier Shows "File Already Exists" for .jinja

**Symptom**:
```
Conflict: src/my_package/memory/__init__.py.jinja already exists
```

**Cause**: Previous upgrade attempt left .jinja file

**Solution**:
```bash
# Remove conflicting file
rm src/my_package/memory/__init__.py.jinja

# Re-run upgrade
copier update --vcs-ref v1.2.0 --trust --force
```

### Issue 4: security_email Prompt Appears But Already Set

**Symptom**:
Copier prompts for `security_email` even though you set it

**Cause**: New variable in v1.2.0, not in your .copier-answers.yml yet

**Solution**:
```bash
# Just answer the prompt, it will be saved

# Or: Pre-populate in .copier-answers.yml before upgrade
echo "security_email: security@myorg.com" >> .copier-answers.yml
copier update --vcs-ref v1.2.0 --trust
```

---

## For AI Agents: Decision Documentation

**After completing upgrade, store decision**:

```json
{
  "id": "chora-base-v1.1-to-v1.2-upgrade",
  "created": "2025-10-XX",
  "tags": ["chora-base", "upgrade", "v1.2.0", "critical-fixes"],

  "upgrade": {
    "from": "v1.1.1",
    "to": "v1.2.0",
    "decision": "adopted",
    "reasoning": "REQUIRED for correctness (ImportError fixes), manual merge needed for customizations"
  },

  "critical_fixes": [
    {
      "issue": "ImportError in memory module",
      "files": ["memory/__init__.py", "memory/trace.py"],
      "fix": "Converted to .jinja, use template variables for imports",
      "impact": "Would crash at runtime without fix"
    },
    {
      "issue": "Hardcoded paths in scripts",
      "files": ["check-env.sh", "mcp-tool.sh", "handoff.sh"],
      "fix": "Dynamic path detection, generic placeholders",
      "impact": "Scripts failed for all users except original developer"
    }
  ],

  "merge_conflicts": [
    {
      "file": "memory/__init__.py",
      "template_change": "Fixed imports (mcp_n8n → {{ package_name }})",
      "local_customization": "TRACE_ENABLED config",
      "resolution": "Applied template fix, preserved customization"
    },
    {
      "file": "scripts/check-env.sh",
      "template_change": "Removed hardcoded CHORA_PATH",
      "local_customization": "ANTHROPIC_API_KEY validation",
      "resolution": "Used dynamic detection, preserved validation"
    }
  ],

  "customizations_preserved": [
    "memory/__init__.py: TRACE_ENABLED config intact",
    "check-env.sh: API key validation preserved with dynamic paths"
  ],

  "validation": {
    "imports": "working (no ImportError)",
    "scripts": "working (no hardcoded paths)",
    "tests": "passing (pytest: 42 passed)",
    "coverage": "maintained"
  },

  "time_invested": "90 minutes (upgrade + conflict resolution + testing)",
  "complexity": "HIGH (most complex upgrade in v1.0→v1.4 sequence)"
}
```

---

## Related Documentation

- [Upgrade Philosophy](PHILOSOPHY.md) - Customization preservation strategies
- [Generalization Audit](../../docs/GENERALIZATION_AUDIT_2025-10-18.md) - Full audit findings
- [v1.2.0 CHANGELOG](../../CHANGELOG.md#120---2025-10-18) - Complete release notes
- [Next upgrade: v1.2.0 to v1.3.0](v1.2-to-v1.3.md) - Vision framework (MEDIUM risk)

---

**Note**: This is the **most complex upgrade** in the v1.0→v1.4 sequence due to critical fixes touching customizable code. Take time to review conflicts carefully, test thoroughly, and document your merge decisions.
