# Upgrading from v1.2.0 to v1.3.0

**Release Date**: 2025-10-19
**Template Version**: v1.2.0 → v1.3.0
**Upgrade Effort**: 2-3 hours
**For**: Human developers, AI coding agents

---

## Quick Assessment

| Aspect | Value |
|--------|-------|
| **Effort** | 2-3 hours |
| **Breaking Changes** | No |
| **Required For** | Vision-driven development, strategic design guidance |
| **Can Skip If** | Not using vision framework, have existing planning docs |
| **Displacement Risk** | MEDIUM (may overlap with existing roadmap/planning docs) |
| **Agent Autonomy** | 70% (integration strategy needs evaluation) |

---

## TL;DR

**What's New**:
- Vision framework (dev-docs/vision/, 1040 lines)
- ROADMAP.md template (195 lines)
- AGENTS.md Strategic Design section (+255 lines)
- 3 new copier variables (include_vision_docs, include_roadmap, initial_version)

**Impact on Existing Adopters**:
- IF no existing ROADMAP.md: Safe to adopt (new file)
- IF existing ROADMAP.md: Choose integration strategy (merge, link, or skip)
- IF existing planning docs: Evaluate vision framework value vs current system
- AGENTS.md enhancement: Additive (new Strategic Design section)

**Recommended Action**:
- **For vision-driven projects**: Adopt (strategic design framework)
- **For projects with existing roadmap**: Evaluate integration options
- **For stable projects**: Optional (nice to have, not critical)

---

## Decision Tree for AI Agents

```
START

├─ Does project use AGENTS.md?
│  ├─ YES → Upgrade beneficial (Strategic Design section)
│  └─ NO → Skip (not relevant)
│
├─ Does project have existing ROADMAP.md or planning docs?
│  ├─ NO → Adopt vision framework (fills gap)
│  ├─ YES → Evaluate integration strategy
│  │         ├─ Simple roadmap → Merge with template
│  │         ├─ Complex planning system → Link from vision/
│  │         └─ Prefer existing → Skip vision framework
│
├─ Using vision-driven development approach?
│  ├─ YES → Adopt (framework supports this methodology)
│  └─ NO → Skip (not needed)
│
END: RECOMMENDED for vision-driven projects, OPTIONAL otherwise
```

**Criteria by Project Type**:

| Project Type | Adopt If | Defer If | Skip If |
|--------------|----------|----------|---------|
| **With AGENTS.md** | Want strategic guidance | AGENTS customized heavily | Not using |
| **No ROADMAP.md** | Want planning docs | Not planning yet | Never planning |
| **Existing ROADMAP** | Can integrate | Complex system | Prefer current |
| **Vision-Driven Dev** | Always | N/A | Not this approach |

---

## What Changed

### Files Added

**New Template Files** (in dev-docs/vision/):
1. `template/dev-docs/vision/README.md.jinja` (370 lines)
   - What are vision documents (exploratory vs committed)
   - Decision frameworks and review process
   - Archive policy (quarterly reviews)
   - Integration with ROADMAP.md and AGENTS.md

2. `template/dev-docs/vision/CAPABILITY_EVOLUTION.example.md.jinja` (670 lines)
   - 4-wave capability evolution structure
   - Decision criteria templates (go/no-go frameworks)
   - Success metrics and technical sketches
   - Project-type specific examples

3. `template/ROADMAP.md.jinja` (195 lines)
   - Current focus and near-term roadmap
   - Vision highlights linking to dev-docs/vision/
   - Release history and roadmap philosophy

### Files Modified

**Enhanced Template Files**:

1. `template/AGENTS.md.jinja`
   - **Lines changed**: +255 -0
   - **Change type**: Enhancement (Strategic Design section)
   - **Displacement risk**: LOW (pure addition, before existing content)
   - **Customization impact**: Low (adds new section, unlikely to conflict)
   - **Diff summary**:
     ```diff
     ## 1. Project Overview

     + ### Strategic Context
     + **Current Priority**: [links to ROADMAP.md]
     + **Long-Term Vision**: [links to dev-docs/vision/]

     + ## 2.2 Strategic Design
     + [Vision-aware implementation pattern]
     + [Refactoring decision framework - ASCII flowchart]
     + [Knowledge capture patterns]

     ## 3. Common Tasks for Agents

     + ### Design Decision: Check Against Vision
     + [Step-by-step decision documentation workflow]
     ```

2. `copier.yml`
   - **Lines changed**: +20 -0
   - **Change type**: New variables (3 added)
   - **Displacement risk**: NONE
   - **Diff summary**:
     ```yaml
     + include_vision_docs:
     +   type: bool
     +   help: Include vision & strategic design framework?
     +   default: true
     +   when: "{{ include_agents_md }}"

     + include_roadmap:
     +   type: bool
     +   help: Include ROADMAP.md template?
     +   default: true

     + initial_version:
     +   type: str
     +   help: Initial project version
     +   default: "0.1.0"
     +   validator: [semver check]

     + _exclude:
     +   - "{% if not include_vision_docs %}dev-docs/vision{% endif %}"
     +   - "{% if not include_roadmap %}ROADMAP.md.jinja{% endif %}"
     ```

3. `README.md` (chora-base repo)
   - **Lines changed**: +9 -0
   - **Impact**: Only affects chora-base repo

---

## Displacement Analysis

### Type 1: Required (Correctness Fixes)

**None** - This release contains no critical fixes.

### Type 2: Optional (Workflow Improvements)

**None** - This release does not advocate replacing existing workflows (vision framework is optional).

### Type 3: Additive (Safe Enhancements)

#### Enhancement 1: Vision Framework (dev-docs/vision/)

**What Added**:
- Vision directory with README and example
- Exploratory capability planning structure
- Decision frameworks for strategic choices

**Benefits**:
- Document long-term plans separate from committed roadmap
- Guide AI agents in strategic design decisions
- Reduce premature optimization (check against vision first)

**Costs**:
- Learning vision doc structure
- Quarterly review process overhead

**Conflict Potential**: LOW (new directory, unless you already have dev-docs/vision/)

**Decision**:
- Adopt if: Using vision-driven development
- Skip if: Happy with existing planning system

#### Enhancement 2: ROADMAP.md Template

**What Added**:
- Roadmap template with vision integration
- Current focus + near-term roadmap structure
- Release history section

**Benefits**:
- Structured roadmap format
- Links to vision documents
- Standard across chora-base projects

**Costs**:
- May conflict with existing ROADMAP.md

**Conflict Potential**: **MEDIUM** (if you already have ROADMAP.md)

**Decision**:
- Adopt if: No existing ROADMAP.md
- Integrate if: Existing simple roadmap (merge content)
- Link if: Existing complex roadmap (link from vision/)
- Skip if: Prefer existing roadmap format

#### Enhancement 3: AGENTS.md Strategic Design Section

**What Added** (255 lines):
- Strategic Context subsection (current priority, long-term vision)
- Strategic Design section (vision-aware implementation pattern)
- Refactoring decision framework (when to refactor vs defer)
- Knowledge capture patterns (document design decisions)
- "Check Against Vision" task

**Benefits**:
- Agents understand project evolution direction
- Framework for strategic decisions (not just tactical)
- Systems thinking mindset (Section 2.2 of best practices)

**Costs**:
- None (pure addition, doesn't replace existing)

**Conflict Potential**: LOW (adds new section before existing content)

**Decision**: Adopt if using AGENTS.md

---

## Upgrade Steps

### Prerequisites

```bash
# 1. Ensure clean git state
git status

# 2. Create backup
git branch backup-pre-upgrade-v1.3.0
git tag backup-v1.2.0

# 3. Check for existing files that may conflict
ls -la ROADMAP.md               # Check if exists
ls -la dev-docs/vision/         # Check if directory exists

# 4. Document current roadmap/planning system
# If you have existing ROADMAP.md or planning docs, note their structure
```

### Automated Upgrade

```bash
# Update to v1.3.0
copier update --vcs-ref v1.3.0 --trust

# You'll be prompted for new variables:
# include_vision_docs (Include vision framework?): [true]
# include_roadmap (Include ROADMAP.md template?): [true]
# initial_version (Initial project version): [0.1.0]

# Answer based on your needs:
# - include_vision_docs: true if want vision framework, false if not
# - include_roadmap: true if no existing ROADMAP.md, false if have one
# - initial_version: Your project's current version (e.g., "1.0.0")

# Review changes
git diff
```

### Manual Conflict Resolution

**Conflicts are possible** if you have existing ROADMAP.md or dev-docs/vision/.

#### Conflict 1: ROADMAP.md (Existing File)

**Template Change** (new file):
```markdown
# {{ project_name }} Roadmap

## Current Focus
[template content]

## Vision Highlights
Links to dev-docs/vision/

## Near-Term Roadmap
[template structure]
```

**Your Existing File**:
```markdown
# My Project Roadmap

## Q4 2025
- Feature X
- Feature Y

## Q1 2026
- Feature Z
```

**Integration Strategy Options**:

**Option A: Merge** (if your roadmap is simple):
```markdown
# {{ project_name }} Roadmap

## Current Focus
Q4 2025: Shipping Feature X and Y

## Vision Highlights
See [dev-docs/vision/](dev-docs/vision/) for long-term plans.

## Near-Term Roadmap

### Q4 2025
- Feature X: [your description]
- Feature Y: [your description]

### Q1 2026
- Feature Z: [your description]
```

**Option B: Link** (if your roadmap is complex):
```markdown
# {{ project_name }} Roadmap

**See**: [PROJECT_ROADMAP.md](PROJECT_ROADMAP.md) for detailed roadmap.

## Vision Highlights
Long-term exploratory plans: [dev-docs/vision/](dev-docs/vision/)

## Integration
- **Committed Roadmap**: PROJECT_ROADMAP.md (our existing detailed plan)
- **Exploratory Vision**: dev-docs/vision/ (future possibilities)
```

**Option C: Skip** (keep existing, don't adopt template):
```bash
# Answer "false" to include_roadmap during upgrade
# Keep your existing ROADMAP.md unchanged
```

#### Conflict 2: AGENTS.md (Strategic Design Section)

**Template Change** (adds new section):
```markdown
## 1. Project Overview

### Strategic Context

**Current Priority**: See [ROADMAP.md](ROADMAP.md) for current focus.

**Long-Term Vision**: See [dev-docs/vision/](dev-docs/vision/) for exploratory capabilities.

[rest of existing content]

## 2.2 Strategic Design

[new section with decision frameworks]
```

**Your Customization** (likely):
```markdown
## 1. Project Overview

[your existing project overview]

## 2. Common Tasks for Agents

[your existing tasks]
```

**Merge Strategy**:
1. Accept template's Strategic Context subsection (adds to section 1)
2. Accept template's Strategic Design section (new section 2.2)
3. Your existing sections remain intact
4. Combined result:
   ```markdown
   ## 1. Project Overview

   ### Strategic Context (TEMPLATE ADDED)
   [template content]

   [Your existing overview content] (PRESERVED)

   ## 2. Common Tasks

   ## 2.2 Strategic Design (TEMPLATE ADDED)
   [template content]

   [Your existing common tasks] (PRESERVED)
   ```

**Validation**:
```bash
# Check AGENTS.md has all sections
cat AGENTS.md | grep "^##"
# Should show: Project Overview, Strategic Design, your custom sections
```

---

## Validation Checklist

### Core Functionality

- [ ] Project imports work: `python -c "from {{ package_name }} import *"`
- [ ] Tests pass: `pytest`
- [ ] Scripts execute: `./scripts/check-env.sh`
- [ ] No code changed (this is docs/config release)

### Template Integration

- [ ] `.copier-answers.yml` shows `_commit: v1.3.0`
- [ ] New variables set:
  - [ ] `include_vision_docs` (true/false)
  - [ ] `include_roadmap` (true/false)
  - [ ] `initial_version` (your version)
- [ ] If `include_vision_docs=true`: `dev-docs/vision/` exists
- [ ] If `include_roadmap=true`: `ROADMAP.md` exists
- [ ] AGENTS.md has Strategic Design section

### Integration

- [ ] If existing ROADMAP.md: Integration strategy applied (merge/link/skip)
- [ ] AGENTS.md custom sections preserved
- [ ] Vision docs link correctly from ROADMAP.md
- [ ] Vision docs link correctly from AGENTS.md

### Quality Gates

- [ ] Pre-commit hooks pass: `pre-commit run --all-files`
- [ ] Linting passes: `ruff check .`
- [ ] Type checking passes: `mypy src/`
- [ ] Coverage maintained: `pytest --cov`

---

## Example Upgrade Session

```bash
# Starting state (v1.2.0 project with existing simple ROADMAP.md)
$ cat .copier-answers.yml | grep _commit
_commit: v1.2.0

$ ls -la ROADMAP.md
-rw-r--r-- 1 user user 245 Oct 10 ROADMAP.md

# Create backup
$ git branch backup-pre-upgrade-v1.3.0
$ git tag backup-v1.2.0

# Run upgrade
$ copier update --vcs-ref v1.3.0 --trust

[copier prompts]
include_vision_docs (Include vision framework?): [true]
# Answer: true (I want vision framework)

include_roadmap (Include ROADMAP.md template?): [true]
# CONFLICT WARNING: ROADMAP.md already exists
# Answer: true (I'll merge manually)

initial_version (Initial project version): [0.1.0]
# Answer: 1.2.0 (my current version)

# Review changes
$ git status
On branch main
Changes not staged for commit:
  modified:   .copier-answers.yml
  modified:   AGENTS.md
  new file:   dev-docs/vision/README.md
  new file:   dev-docs/vision/CAPABILITY_EVOLUTION.example.md
  modified:   ROADMAP.md  # CONFLICT

# Resolve ROADMAP.md conflict
$ git diff ROADMAP.md
# Shows template version vs my version

# Strategy: Merge (my roadmap is simple)
$ nano ROADMAP.md
# Manually combine:
# - Template structure (sections)
# - My existing content (Q4/Q1 plans)
# - Add vision highlights link

# Result:
$ cat ROADMAP.md | head -20
# {{ project_name }} Roadmap

## Current Focus
Q4 2025: Feature X and Y

## Vision Highlights
See [dev-docs/vision/](dev-docs/vision/) for long-term capabilities.

## Near-Term Roadmap
### Q4 2025
- Feature X: [my description]

# Check AGENTS.md (should have Strategic Design section)
$ cat AGENTS.md | grep "^## "
## 1. Project Overview
## 2.2 Strategic Design
## 3. Common Tasks for Agents

# Validate
$ pytest
===== 42 passed in 3.14s =====

# Commit
$ git add .
$ git commit -m "chore: Upgrade to chora-base v1.3.0

- Updated from v1.2.0 to v1.3.0
- Added vision framework (dev-docs/vision/)
- Enhanced AGENTS.md with Strategic Design section
- Merged template ROADMAP.md with existing roadmap
- Set initial_version to 1.2.0
- All tests passing

See docs/upgrades/v1.2-to-v1.3.md for details"
```

---

## Rollback Procedure

**If upgrade fails or conflicts are too complex**:

```bash
# Option 1: Rollback commit
git reset --hard HEAD~1

# Option 2: Restore from backup
git checkout main
git reset --hard backup-pre-upgrade-v1.3.0

# Option 3: Restore from tag
git checkout main
git reset --hard backup-v1.2.0

# Verify rollback
cat .copier-answers.yml | grep _commit
# Should show v1.2.0

./scripts/check-env.sh
pytest
```

---

## Common Issues

### Issue 1: ROADMAP.md Conflict - Can't Decide Strategy

**Symptom**: Not sure whether to merge, link, or skip

**Solution**:
```bash
# Evaluate your existing ROADMAP.md complexity
wc -l ROADMAP.md
# < 50 lines → Merge (simple)
# 50-200 lines → Link (medium)
# > 200 lines → Skip (complex, keep existing)

# Merge example (simple):
# Combine template structure + your content

# Link example (medium):
# Keep your ROADMAP_DETAILED.md
# Use template ROADMAP.md as index with link

# Skip example (complex):
# Answer "false" to include_roadmap
# Keep your existing file unchanged
```

### Issue 2: dev-docs/vision/ Already Exists

**Symptom**:
```
Error: dev-docs/vision/ already exists
```

**Cause**: You already created vision docs manually

**Solution**:
```bash
# Option A: Rename yours, adopt template
mv dev-docs/vision dev-docs/vision-old
copier update --vcs-ref v1.3.0 --trust
# Then merge your content into template structure

# Option B: Skip vision framework
# Answer "false" to include_vision_docs
# Keep your existing vision docs
```

---

## For AI Agents: Decision Documentation

**After completing upgrade, store decision**:

```json
{
  "id": "chora-base-v1.2-to-v1.3-upgrade",
  "created": "2025-10-XX",
  "tags": ["chora-base", "upgrade", "v1.3.0", "vision-framework"],

  "upgrade": {
    "from": "v1.2.0",
    "to": "v1.3.0",
    "decision": "adopted",
    "reasoning": "Vision framework valuable for strategic design guidance"
  },

  "new_features": [
    {
      "feature": "Vision framework",
      "files": ["dev-docs/vision/README.md", "dev-docs/vision/CAPABILITY_EVOLUTION.example.md"],
      "adopted": true,
      "benefit": "Document long-term plans, guide strategic decisions"
    },
    {
      "feature": "ROADMAP.md template",
      "adopted": true,
      "strategy": "merged with existing roadmap",
      "result": "Combined template structure + existing Q4/Q1 content"
    },
    {
      "feature": "AGENTS.md Strategic Design",
      "adopted": true,
      "benefit": "Refactoring decision framework, vision-aware implementation"
    }
  ],

  "customizations_preserved": [
    "ROADMAP.md: Existing Q4/Q1 plan content merged with template structure",
    "AGENTS.md: Custom task sections intact after new Strategic Design section"
  ],

  "validation": {
    "tests": "passing",
    "coverage": "maintained",
    "vision_links": "working (ROADMAP → vision/, AGENTS → vision/)"
  },

  "time_invested": "2 hours (upgrade + ROADMAP merge + validation)"
}
```

---

## Related Documentation

- [Upgrade Philosophy](PHILOSOPHY.md) - Integration strategies for additive features
- [v1.3.0 CHANGELOG](../../CHANGELOG.md#130---2025-10-19) - Complete release notes
- [Vision Framework Guide](../../docs/how-to/06-maintain-vision-documents.md) - How to use vision docs
- [Vision Philosophy](../../docs/explanation/vision-driven-development.md) - Why vision-driven development
- [Next upgrade: v1.3.0 to v1.4.0](v1.3-to-v1.4.md) - PyPI + just workflow (MEDIUM risk)

---

**Note**: This upgrade is **primarily additive** - it adds vision framework and enhances AGENTS.md without removing anything. The main decision point is integration strategy if you have existing ROADMAP.md or planning docs.
