{# Compute SAP enablement inline - workaround for Copier limitation with derived variables #}
{% set sap_001 = sap_selection_mode != 'custom' or (include_sap_001 | default(false)) %}
{% set sap_015 = sap_selection_mode != 'custom' or (include_sap_015 | default(false)) %}
{% set sap_053 = sap_selection_mode in ['standard', 'comprehensive'] or (sap_selection_mode == 'custom' and (include_sap_053 | default(false))) %}
{% set sap_010 = sap_selection_mode in ['standard', 'comprehensive'] or (sap_selection_mode == 'custom' and (include_sap_010 | default(false))) %}
{% set sap_051 = sap_selection_mode == 'comprehensive' or (sap_selection_mode == 'custom' and (include_sap_051 | default(false))) %}
{% set sap_052 = sap_selection_mode == 'comprehensive' or (sap_selection_mode == 'custom' and (include_sap_052 | default(false))) %}
{% set sap_056 = sap_selection_mode == 'comprehensive' or (sap_selection_mode == 'custom' and (include_sap_056 | default(false))) %}
{% set sap_008 = sap_selection_mode == 'comprehensive' or (sap_selection_mode == 'custom' and (include_sap_008 | default(false))) %}
{% set sap_total = [sap_001, sap_015, sap_053, sap_010, sap_051, sap_052, sap_056, sap_008] | select | list | length %}
{% if sap_053 or sap_052 or sap_056 or sap_008 or sap_010 %}[tool.poetry]
name = "{{ project_slug }}"
version = "0.1.0"
description = "{{ project_name }} - Generated from chora-base template"
authors = ["{{ author_name }} <{{ author_email }}>"]
readme = "README.md"
{% if use_poetry %}
packages = [{include = "{{ project_slug }}"}]
{% endif %}

[tool.poetry.dependencies]
python = "^{{ python_version }}"
{% if sap_053 or sap_052 or sap_056 or sap_008 or sap_010 %}
click = "^8.1.7"            # CLI framework for scripts
{% endif %}
{% if sap_053 or sap_056 %}
pyyaml = "^6.0.1"           # YAML parsing for feature-manifest, CODEOWNERS
{% endif %}
{% if ((sap_selection_mode in ['standard', 'comprehensive']) or (sap_selection_mode == 'custom' and (include_sap_010 | default(false)))) %}
python-dateutil = "^2.8.2"  # Date parsing for A-MEM events
{% endif %}

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.3"
pytest-cov = "^4.1.0"
black = "^23.12.1"
ruff = "^0.1.8"

{% if ((sap_selection_mode in ['standard', 'comprehensive']) or (sap_selection_mode == 'custom' and (include_sap_053 | default(false)))) %}[tool.black]
line-length = 100
target-version = ['py{{ python_version.replace(".", "") }}']

[tool.ruff]
line-length = 100
target-version = "py{{ python_version.replace('.', '') }}"
select = ["E", "F", "I", "N", "W"]
ignore = ["E501"]  # Line too long (handled by black)
{% endif %}

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
{% else %}# No Python-dependent SAPs enabled - pyproject.toml not needed
# If you need Python dependencies, enable SAP-053, SAP-052, SAP-056, SAP-008, or SAP-010
{% endif %}
