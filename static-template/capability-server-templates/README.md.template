# {{ capability_name }}

**Multi-interface capability server with CLI, REST API{% if enable_mcp %}, and MCP support{% endif %}**

[![Python Version](https://img.shields.io/badge/python-3.11%2B-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Code Style](https://img.shields.io/badge/code%20style-ruff-000000.svg)](https://github.com/astral-sh/ruff)
[![Type Checked](https://img.shields.io/badge/type%20checked-mypy-blue.svg)](http://mypy-lang.org/)
[![Test Coverage](https://img.shields.io/badge/coverage-85%25%2B-brightgreen.svg)](pytest.ini)

---

## Overview

{{ capability_name }} is a production-ready capability server that provides multiple interfaces for managing {{ capability_name_lower }} entities. Built with the **capability server architecture** (chora-base SAP-042-047), it features:

- **üéØ Core/Interface Separation**: Business logic independent of interface choice
- **üîå Multiple Interfaces**: Choose CLI, REST API{% if enable_mcp %}, or MCP{% endif %} based on your needs
- **‚úÖ Type Safety**: Full Pydantic validation and mypy type checking
- **üß™ Comprehensive Testing**: 85%+ test coverage with pytest
- **üìù Rich Documentation**: OpenAPI, CLI help, {% if enable_mcp %}MCP resources, {% endif %}and architecture docs
- **üöÄ Production Ready**: Error handling, logging, health checks, and deployment configs
{% if enable_registry %}- **üîç Service Discovery**: Built-in registry for capability-based lookup (SAP-044)
{% endif %}{% if enable_bootstrap %}- **‚ö° Smart Startup**: Dependency-ordered bootstrap orchestration (SAP-045)
{% endif %}{% if enable_composition %}- **üõ°Ô∏è Resilience Patterns**: Circuit breakers, saga orchestration, event bus (SAP-046)
{% endif %}
---

## Quick Start

### Installation

```bash
# Install from PyPI
pip install {{ package_name }}

# Or install from source
git clone https://github.com/yourusername/{{ package_name }}.git
cd {{ package_name }}
pip install -e ".[dev]"
```

### Basic Usage

#### CLI Interface

```bash
# Create an entity
{{ package_name }} create "My First Task" --description "Get started with {{ capability_name_lower }}"

# List all entities
{{ package_name }} list

# Get specific entity
{{ package_name }} get <entity-id>

# Update status
{{ package_name }} status <entity-id> completed

# Get help
{{ package_name }} --help
```

#### REST API Interface

```bash
# Start the API server
uvicorn {{ package_name }}.interfaces.rest:app --reload

# API will be available at http://localhost:8000
# OpenAPI docs: http://localhost:8000/docs
# ReDoc: http://localhost:8000/redoc
```

```bash
# Create entity via API
curl -X POST http://localhost:8000/api/v1/{{ namespace }}/entities \
  -H "Content-Type: application/json" \
  -d '{"name": "My Task", "description": "Via REST API"}'

# List entities
curl http://localhost:8000/api/v1/{{ namespace }}/entities
```

{% if enable_mcp %}#### MCP Interface

```bash
# Start MCP server
{{ namespace }}-mcp

# Or use with MCP client
mcp install {{ namespace }}-mcp

# Available tools:
# - {{ namespace }}:create
# - {{ namespace }}:get
# - {{ namespace }}:list
# - {{ namespace }}:update
# - {{ namespace }}:delete
# - {{ namespace }}:status
# - {{ namespace }}:health
```

**Claude Desktop Integration**:

Add to `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "{{ namespace }}": {
      "command": "{{ namespace }}-mcp"
    }
  }
}
```
{% endif %}
---

## Features

### Core Capabilities

- **Create**: Add new {{ capability_name_lower }} entities with validation
- **Read**: Retrieve entities by ID or filter by criteria
- **Update**: Modify entity properties and status
- **Delete**: Remove entities (single or bulk operations)
- **Filter**: Query by status, name, metadata, creation date
- **Pagination**: Efficient handling of large datasets

### Interface Features

#### CLI Features
- **Multiple Output Formats**: JSON, table, YAML
- **Rich Terminal Output**: Colors, tables, progress indicators
- **Scripting Support**: Exit codes, JSON output for automation
- **Interactive Mode**: Prompts for missing required arguments

#### REST API Features
- **OpenAPI Documentation**: Auto-generated, interactive docs
- **CORS Support**: Configurable cross-origin requests
- **Async Performance**: FastAPI with async/await throughout
- **Error Handling**: Standardized error responses
- **Health Checks**: `/health` and `/ready` endpoints

{% if enable_mcp %}#### MCP Features
- **7 Tools**: Complete CRUD operations via MCP
- **4 Resources**: Documentation, examples, API reference
- **Structured Responses**: JSON output for all operations
- **Error Handling**: Clear error messages for Claude/agents
{% endif %}
{% if enable_registry %}### Service Discovery (SAP-044)

- **Registry-Based Discovery**: Find services by capability
- **Health Monitoring**: Automatic heartbeat tracking
- **Capability-Based Lookup**: Query services by what they can do
- **Timeout Detection**: Auto-remove unhealthy services
{% endif %}
{% if enable_bootstrap %}### Smart Startup (SAP-045)

- **Dependency Resolution**: Topological sort (Kahn's algorithm)
- **Ordered Startup**: Components start in correct dependency order
- **Automatic Rollback**: Shutdown on critical component failure
- **Parallel Initialization**: Independent components start concurrently
{% endif %}
{% if enable_composition %}### Resilience Patterns (SAP-046)

- **Circuit Breaker**: Prevent cascading failures (CLOSED/OPEN/HALF_OPEN states)
- **Saga Orchestration**: Distributed transactions with compensation
- **Event Bus**: Asynchronous pub-sub communication with error isolation
{% endif %}
---

## Architecture

{{ capability_name }} follows the **core/interface separation pattern** (SAP-042):

```
{{ package_name }}/
‚îú‚îÄ‚îÄ core/                   # Business logic (interface-agnostic)
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # Pydantic domain models
‚îÇ   ‚îú‚îÄ‚îÄ services.py         # Service layer (CRUD operations)
‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py       # Error hierarchy
‚îú‚îÄ‚îÄ interfaces/             # Interface adapters
‚îÇ   ‚îú‚îÄ‚îÄ cli/                # Click CLI
‚îÇ   ‚îú‚îÄ‚îÄ rest/               # FastAPI REST
{% if enable_mcp %}‚îÇ   ‚îî‚îÄ‚îÄ mcp/                # FastMCP interface
{% endif %}{% if enable_registry or enable_bootstrap or enable_composition %}‚îú‚îÄ‚îÄ infrastructure/         # Infrastructure patterns
{% if enable_registry %}‚îÇ   ‚îú‚îÄ‚îÄ registry/           # Service discovery
{% endif %}{% if enable_bootstrap %}‚îÇ   ‚îú‚îÄ‚îÄ bootstrap/          # Startup orchestration
{% endif %}{% if enable_composition %}‚îÇ   ‚îî‚îÄ‚îÄ composition/        # Saga, circuit breaker, events
{% endif %}{% endif %}‚îî‚îÄ‚îÄ tests/                  # Comprehensive test suite
```

**Design Principles**:
1. **Core Independence**: Business logic has no interface dependencies
2. **Type Safety**: Pydantic models + mypy = runtime + static validation
3. **Dependency Injection**: Swappable implementations (in-memory, database, etc.)
4. **Error Handling**: Rich exception hierarchy with serialization
5. **Test Coverage**: 85%+ coverage target with unit + integration tests

See [ARCHITECTURE.md](ARCHITECTURE.md) for detailed architecture documentation.

---

## Development

### Setup Development Environment

```bash
# Clone repository
git clone https://github.com/yourusername/{{ package_name }}.git
cd {{ package_name }}

# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install development dependencies
pip install -e ".[dev]"

# Install pre-commit hooks
pre-commit install
```

### Running Tests

```bash
# Run all tests
pytest

# Run with coverage
pytest --cov={{ package_name }} --cov-report=html

# Run specific test file
pytest tests/core/test_models.py

# Run tests in parallel
pytest -n auto

# Run with markers
pytest -m unit          # Only unit tests
pytest -m integration   # Only integration tests
pytest -m "not slow"    # Skip slow tests
```

### Code Quality

```bash
# Lint with ruff
ruff check .

# Format with ruff
ruff format .

# Type check with mypy
mypy {{ package_name }}

# Run all pre-commit hooks
pre-commit run --all-files
```

### Building Documentation

```bash
# Install docs dependencies
pip install -e ".[dev]"

# Serve docs locally
mkdocs serve

# Build static docs
mkdocs build
```

---

## Deployment

### Docker Deployment

```bash
# Build Docker image
docker build -t {{ package_name }}:latest .

# Run REST API server
docker run -p 8000:8000 {{ package_name }}:latest

# Run CLI
docker run {{ package_name }}:latest {{ package_name }} --help
```

### Production Deployment

```bash
# Install production dependencies
pip install {{ package_name }}

# Run REST API with Gunicorn
gunicorn {{ package_name }}.interfaces.rest:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000

# Or use Docker Compose
docker-compose up -d
```

See [ARCHITECTURE.md](ARCHITECTURE.md) for detailed deployment instructions.

---

## Configuration

### Environment Variables

```bash
# Application settings
export {{ package_name.upper() }}_LOG_LEVEL=INFO
export {{ package_name.upper() }}_ENV=production

# REST API settings
export {{ package_name.upper() }}_API_HOST=0.0.0.0
export {{ package_name.upper() }}_API_PORT=8000
export {{ package_name.upper() }}_API_WORKERS=4

# CORS settings
export {{ package_name.upper() }}_CORS_ORIGINS=https://example.com,https://app.example.com
```

### Configuration File

Create `.{{ package_name }}.yaml` in your home directory or project root:

```yaml
log_level: INFO
environment: production

api:
  host: 0.0.0.0
  port: 8000
  workers: 4

cors:
  enabled: true
  origins:
    - https://example.com
    - https://app.example.com
```

---

## Documentation

- **[AGENTS.md](AGENTS.md)**: Complete reference for AI agents and developers
- **[CLI.md](CLI.md)**: CLI command reference
- **[API.md](API.md)**: REST API reference
- **[ARCHITECTURE.md](ARCHITECTURE.md)**: Architecture deep dive
- **OpenAPI Docs**: http://localhost:8000/docs (when server running)
{% if enable_mcp %}- **MCP Resources**: Available via `{{ namespace }}:docs` resource
{% endif %}
---

## Examples

### Example 1: Create and Track Entities

```python
from {{ package_name }}.core import {{ capability_name_pascal }}Service, CreateEntityRequest

# Create service
service = {{ capability_name_pascal }}Service()

# Create entity
request = CreateEntityRequest(
    name="My Task",
    description="Important work",
    metadata={"priority": "high", "assignee": "alice"}
)
entity = await service.create(request)

# Get entity
retrieved = await service.get(entity.id)

# Update status
updated = await service.update_status(entity.id, "in_progress")

# List all active entities
active = await service.list(filters={"status": "active"})
```

### Example 2: REST API Client

```python
import httpx

async with httpx.AsyncClient() as client:
    # Create entity
    response = await client.post(
        "http://localhost:8000/api/v1/{{ namespace }}/entities",
        json={"name": "My Task", "description": "Via API"}
    )
    entity = response.json()

    # Get entity
    response = await client.get(
        f"http://localhost:8000/api/v1/{{ namespace }}/entities/{entity['id']}"
    )
    retrieved = response.json()
```

### Example 3: CLI Scripting

```bash
#!/bin/bash
# Bulk create entities from CSV

while IFS=, read -r name description; do
  {{ package_name }} create "$name" --description "$description" --format json
done < entities.csv

# Export all entities to JSON
{{ package_name }} list --format json > entities_backup.json
```

{% if enable_mcp %}### Example 4: MCP Integration

```python
# In Claude Desktop or MCP client
# Use the {{ namespace }} tools:

# Create entity
{{ namespace }}:create(name="My Task", description="Via MCP")

# List entities
{{ namespace }}:list(status="active")

# Update entity
{{ namespace }}:update(id="...", name="Updated Task")
```
{% endif %}
---

## Performance

- **CLI**: <100ms for most operations
- **REST API**: 1000+ requests/second (single worker)
- **Memory**: ~50MB baseline, +10MB per 10K entities (in-memory)
- **Startup**: <1 second{% if enable_bootstrap %} (with bootstrap orchestration){% endif %}

See [ARCHITECTURE.md](ARCHITECTURE.md) for scaling and performance optimization.

---

## Security

- **Input Validation**: Pydantic models validate all inputs
- **SQL Injection**: N/A (in-memory by default)
- **XSS Protection**: Automatic escaping in REST responses
- **CORS**: Configurable origin whitelist
- **Rate Limiting**: Implement via middleware (see docs)

See [ARCHITECTURE.md](ARCHITECTURE.md) for security recommendations.

---

## Troubleshooting

### Common Issues

**ImportError: No module named '{{ package_name }}'**
```bash
pip install -e .  # Install in editable mode
```

**CLI command not found**
```bash
pip install -e .  # Reinstall to register entry points
which {{ package_name }}  # Verify installation
```

**REST API CORS errors**
```bash
export {{ package_name.upper() }}_CORS_ORIGINS=http://localhost:3000
uvicorn {{ package_name }}.interfaces.rest:app --reload
```

{% if enable_mcp %}**MCP server not found in Claude Desktop**
```bash
# Verify installation
which {{ namespace }}-mcp

# Test manually
{{ namespace }}-mcp

# Check Claude Desktop config
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json
```
{% endif %}
See [AGENTS.md](AGENTS.md) for more troubleshooting guidance.

---

## Contributing

We welcome contributions! Please see:

1. **Development Setup**: See "Development" section above
2. **Code Style**: We use ruff (linting + formatting) and mypy (type checking)
3. **Testing**: All code must have tests (85%+ coverage target)
4. **Documentation**: Update relevant docs (AGENTS.md, CLI.md, API.md, etc.)

```bash
# Before submitting PR:
pre-commit run --all-files  # Run quality checks
pytest                      # Run tests
mypy {{ package_name }}            # Type check
```

---

## License

This project is licensed under the MIT License - see [LICENSE](LICENSE) file for details.

---

## Acknowledgments

- Built with the **chora-base capability server architecture** (SAP-042-047)
- Inspired by the **chora-base SAP framework** for reusable capabilities
- Powered by [FastAPI](https://fastapi.tiangolo.com/), [Click](https://click.palletsprojects.com/){% if enable_mcp %}, and [FastMCP](https://github.com/jlowin/fastmcp){% endif %}

---

## Links

- **Homepage**: https://github.com/yourusername/{{ package_name }}
- **Documentation**: https://{{ package_name }}.readthedocs.io
- **Issues**: https://github.com/yourusername/{{ package_name }}/issues
- **Changelog**: [CHANGELOG.md](CHANGELOG.md)
- **PyPI**: https://pypi.org/project/{{ package_name }}/

---

**Generated by**: chora-base SAP-047 (Capability Server Template)
**Template Version**: 0.3.0 (Phase 3 Complete - Infrastructure)
**Last Updated**: 2025-11-12
