# {{ capability_name }} - Agent Awareness

**Type**: Capability Server
**Architecture**: Multi-Interface (CLI, REST{% if enable_mcp %}, MCP{% endif %})
**Generated by**: chora-base SAP-047 (Capability Server Template)
**Version**: 0.1.0

---

## Quick Start for AI Agents

This is a **{{ capability_name }}** capability server with multiple interfaces:
- ✅ **CLI**: Click-based command-line interface
- ✅ **REST API**: FastAPI with OpenAPI documentation
{% if enable_mcp %}- ✅ **MCP**: Model Context Protocol for AI assistants{% endif %}

**Primary use case**: [Describe what this capability server does]

---

## Architecture Overview

This capability server follows the **core/interface separation pattern** (SAP-042):

```
{{ package_name }}/
├── core/              # Business logic (interface-agnostic)
│   ├── models.py      # Domain models
│   ├── services.py    # Service layer
│   └── exceptions.py  # Error handling
├── interfaces/        # Interface adapters
│   ├── cli/          # Click CLI
│   ├── rest/         # FastAPI REST
{% if enable_mcp %}│   └── mcp/          # MCP tools/resources
{% endif %}{% if enable_registry or enable_bootstrap or enable_composition %}├── infrastructure/   # Optional patterns
{% if enable_registry %}│   ├── registry/     # Service discovery (SAP-044)
{% endif %}{% if enable_bootstrap %}│   ├── bootstrap/    # Startup orchestration (SAP-045)
{% endif %}{% if enable_composition %}│   └── composition/ # Saga, circuit breaker, events (SAP-046)
{% endif %}{% endif %}└── tests/           # Comprehensive test suite
```

---

## CLI Interface

**Quick Reference**:

```bash
# Create entity
{{ package_name }} create "Entity Name" --description "Description"

# List entities
{{ package_name }} list

# Get specific entity
{{ package_name }} get <entity-id>

# Update entity
{{ package_name }} update <entity-id> --name "New Name"

# Update status
{{ package_name }} status <entity-id> <new-status>

# Delete entity
{{ package_name }} delete <entity-id>

# Health check
{{ package_name }} health
```

**Output Formats**:
- `--format json` - JSON output (default)
- `--format table` - ASCII table
- `--format yaml` - YAML output

**See**: [CLI.md](CLI.md) for complete CLI reference

---

## REST API Interface

**Base URL**: `http://localhost:8000`

**Quick Reference**:

```bash
# Create entity
curl -X POST http://localhost:8000/api/v1/{{ namespace }}/entities \
  -H "Content-Type: application/json" \
  -d '{"name": "Entity Name", "description": "Description"}'

# List entities
curl http://localhost:8000/api/v1/{{ namespace }}/entities

# Get entity
curl http://localhost:8000/api/v1/{{ namespace }}/entities/<entity-id>

# Health check
curl http://localhost:8000/health
```

**OpenAPI Docs**: `http://localhost:8000/docs` (when server running)

**See**: [API.md](API.md) for complete API reference

---

{% if enable_mcp %}## MCP Interface

**Server Name**: `{{ namespace }}`

**Quick Reference** (for AI assistants):

**Available Tools**:
- `{{ namespace }}:create` - Create new entity
- `{{ namespace }}:get` - Get entity by ID
- `{{ namespace }}:list` - List all entities
- `{{ namespace }}:update` - Update entity
- `{{ namespace }}:delete` - Delete entity
- `{{ namespace }}:update_status` - Update entity status
- `{{ namespace }}:health` - Health check

**Available Resources**:
- `{{ namespace }}://docs/readme` - Getting started guide
- `{{ namespace }}://docs/api-reference` - Complete tool reference
- `{{ namespace }}://docs/examples` - Usage examples
- `{{ namespace }}://templates/entity` - Entity JSON template

**Example Usage** (in Claude Desktop):

```
User: Create a new task called "Review PR"
Claude: [Uses {{ namespace }}:create tool]
Result: Created entity with ID abc-123
```

**MCP Server Setup** (Claude Desktop):

```json
{
  "mcpServers": {
    "{{ namespace }}": {
      "command": "{{ package_name }}-mcp"
    }
  }
}
```

---

{% endif %}## Core Domain Models

**Entity Status Flow**:
```
pending → active → completed
    ↓        ↓
  failed   failed
```

**Key Models**:
- `{{ capability_name_pascal }}Entity` - Main domain entity
- `{{ capability_name_pascal }}Request` - Entity creation/update
- `{{ capability_name_pascal }}Response` - Operation result
- `{{ capability_name_pascal }}Filter` - List filtering

---

## Common Workflows

### Workflow 1: Create and Track Entity

```bash
# CLI
ID=$({{ package_name }} create "Task" --format json | jq -r '.entity.id')
{{ package_name }} status $ID active
{{ package_name }} get $ID

# REST API
curl -X POST http://localhost:8000/api/v1/{{ namespace }}/entities \
  -d '{"name":"Task"}' | jq -r '.entity.id'
```

### Workflow 2: List and Filter

```bash
# CLI - filter by status
{{ package_name }} list --status active --format table

# REST API - with pagination
curl "http://localhost:8000/api/v1/{{ namespace }}/entities?status=active&limit=10"
```

### Workflow 3: Update and Complete

```bash
# CLI
{{ package_name }} update $ID --description "Updated"
{{ package_name }} status $ID completed

# REST API
curl -X PUT http://localhost:8000/api/v1/{{ namespace }}/entities/$ID \
  -d '{"description":"Updated"}'
curl -X POST http://localhost:8000/api/v1/{{ namespace }}/entities/$ID/status \
  -d '{"status":"completed"}'
```

---

## Error Handling

**Exception Hierarchy**:
- `{{ capability_name_pascal }}Error` - Base exception
- `{{ capability_name_pascal }}ValidationError` - Invalid input (400)
- `{{ capability_name_pascal }}NotFoundError` - Entity not found (404)
- `{{ capability_name_pascal }}ConflictError` - Duplicate/conflict (409)
- `{{ capability_name_pascal }}PermissionError` - Access denied (403)
- `{{ capability_name_pascal }}RateLimitError` - Too many requests (429)
- `{{ capability_name_pascal }}TimeoutError` - Operation timeout (504)
- `{{ capability_name_pascal }}ServiceError` - Internal error (500)

**Error Response Format**:
```json
{
  "error": "VALIDATION_ERROR",
  "message": "Name must be between 1 and 200 characters",
  "details": {"field": "name", "constraint": "length"}
}
```

---

{% if enable_registry or enable_bootstrap or enable_composition %}## Infrastructure Patterns

{% if enable_registry %}### Service Registry (SAP-044)

**Purpose**: Service discovery and capability registration

```python
from {{ package_name }}.infrastructure.registry import ServiceRegistry

registry = ServiceRegistry()
registration = registry.register(
    service_name="{{ package_name }}",
    service_type="{{ capability_name_lower }}",
    version="1.0.0",
    capabilities=["create", "read", "update", "delete"],
    interfaces=["CLI", "REST"{% if enable_mcp %}, "MCP"{% endif %}],
    endpoints={
        "rest": "http://localhost:8000"{% if enable_mcp %},
        "mcp": "{{ package_name }}-mcp"{% endif %}
    }
)

# Discover services with specific capability
services = registry.discover_capability("create")
```

{% endif %}{% if enable_bootstrap %}### Bootstrap Orchestration (SAP-045)

**Purpose**: Dependency-ordered component startup

```python
from {{ package_name }}.infrastructure.bootstrap import Bootstrap, Component

bootstrap = Bootstrap()

# Register components with dependencies
bootstrap.register_component(Component(
    name="database",
    dependencies=[],
    startup_fn=init_database,
    critical=True
))

bootstrap.register_component(Component(
    name="rest_api",
    dependencies=["database"],
    startup_fn=start_rest_server,
    critical=False
))

# Start all components in dependency order
result = await bootstrap.start()
```

{% endif %}{% if enable_composition %}### Composition Patterns (SAP-046)

**Circuit Breaker** - Prevent cascading failures:
```python
from {{ package_name }}.infrastructure.composition import CircuitBreaker

breaker = CircuitBreaker(failure_threshold=3, recovery_timeout_seconds=30)
result = await breaker.call(external_service_function)
```

**Event Bus** - Event-driven communication:
```python
from {{ package_name }}.infrastructure.composition import EventBus

bus = EventBus()

async def handler(event):
    print(f"Received: {event.event_type}")

bus.subscribe("entity.created", handler)
await bus.publish("entity.created", source="{{ package_name }}", data={"id": "123"})
```

**Saga Pattern** - Distributed transactions:
```python
from {{ package_name }}.infrastructure.composition import create_saga

saga = create_saga()
saga.add_step(name="step1", action=step1_fn, compensation=undo_step1_fn)
saga.add_step(name="step2", action=step2_fn, compensation=undo_step2_fn)

result = await saga.execute()  # Auto-compensates on failure
```

{% endif %}---

{% endif %}## Development

**Run Tests**:
```bash
pytest tests/ -v --cov={{ package_name }} --cov-report=html
```

**Run Linter**:
```bash
ruff check {{ package_name }}/
mypy {{ package_name }}/
```

**Run REST Server** (development):
```bash
uvicorn {{ package_name }}.interfaces.rest:app --reload --port 8000
```

{% if enable_mcp %}**Run MCP Server** (for testing):
```bash
{{ package_name }}-mcp
```
{% endif %}

---

## Configuration

**Environment Variables**:
- `{{ package_name.upper() }}_LOG_LEVEL` - Logging level (default: INFO)
- `{{ package_name.upper() }}_PORT` - REST API port (default: 8000)
{% if enable_registry %}- `{{ package_name.upper() }}_REGISTRY_URL` - Registry endpoint (optional)
{% endif %}

**See**: `{{ package_name }}/config/settings.py` for all configuration options

---

## Testing

**Coverage Target**: 85%+

**Test Structure**:
```
tests/
├── core/              # Core logic tests
├── interfaces/        # CLI, REST{% if enable_mcp %}, MCP{% endif %} tests
{% if enable_registry or enable_bootstrap or enable_composition %}└── infrastructure/   # Infrastructure pattern tests
{% endif %}```

**Run Specific Tests**:
```bash
# Core tests only
pytest tests/core/

# Interface tests
pytest tests/interfaces/

# Single test file
pytest tests/core/test_services.py -v
```

---

## Related Documentation

- **[CLI.md](CLI.md)** - Complete CLI reference
- **[API.md](API.md)** - Complete REST API reference
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - Architecture deep dive
- **[CONTRIBUTING.md](CONTRIBUTING.md)** - Contributing guidelines

---

## SAP References

This capability server implements:
- **SAP-042**: [Interface Design](https://github.com/anthropics/chora-base) - Core/interface separation
- **SAP-043**: [Multi-Interface](https://github.com/anthropics/chora-base) - CLI/REST/MCP patterns
{% if enable_registry %}- **SAP-044**: [Registry](https://github.com/anthropics/chora-base) - Service discovery
{% endif %}{% if enable_bootstrap %}- **SAP-045**: [Bootstrap](https://github.com/anthropics/chora-base) - Startup orchestration
{% endif %}{% if enable_composition %}- **SAP-046**: [Composition](https://github.com/anthropics/chora-base) - Saga, circuit breaker, events
{% endif %}- **SAP-047**: [Capability Server Template](https://github.com/anthropics/chora-base) - Template system

---

## Version History

- **0.1.0** ({{ current_date }}): Initial release
  - Core CRUD operations
  - CLI, REST{% if enable_mcp %}, MCP{% endif %} interfaces
{% if enable_registry or enable_bootstrap or enable_composition %}  - Infrastructure patterns{% if enable_registry %} (registry{% endif %}{% if enable_bootstrap %}{% if enable_registry %}, {% endif %}bootstrap{% endif %}{% if enable_composition %}{% if enable_registry or enable_bootstrap %}, {% endif %}composition{% endif %})
{% endif %}  - Comprehensive test suite (85%+ coverage)

---

**Generated by**: chora-base SAP-047 Capability Server Template
**Documentation**: See [chora-base](https://github.com/anthropics/chora-base) for template details